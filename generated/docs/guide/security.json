{"id":"guide/security","title":"安全","contents":"\n\n\n<div class=\"github-links\">\n  <a href=\"https://github.com/angular/angular-cn/edit/cn/aio/content/guide/security.md?message=docs%3A%20请简述你的修改...\" aria-label=\"提供编辑建议\" title=\"提供编辑建议\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n</div>\n\n\n<div class=\"content\">\n  <h1 id=\"security\" translation-result=\"on\">安全<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#security\"><i class=\"material-icons\">link</i></a></h1><h1 translation-origin=\"off\">Security<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#security\"><i class=\"material-icons\">link</i></a></h1>\n\n<p translation-result=\"on\">本主题会讲述 Angular 为防范 Web 应用常见的安全漏洞和攻击（比如跨站脚本攻击）内置的保护措施，但不会涉及应用级安全，比如用户认证（<em>这个用户是谁？</em>）和授权(<em>这个用户能做什么？</em>)。</p><p translation-origin=\"off\">This topic describes Angular's built-in protections against common web-application vulnerabilities and attacks such as cross-site scripting attacks.\nIt doesn't cover application-level security, such as authentication and authorization.</p>\n\n<p translation-result=\"on\">要了解更多攻防信息，参阅<a href=\"https://www.owasp.org/index.php/Category:OWASP_Guide_Project\">开放式 Web 应用程序安全项目(OWASP)</a>。</p><p translation-origin=\"off\">For more information about the attacks and mitigations described below, see the <a href=\"https://www.owasp.org/index.php/Category:OWASP_Guide_Project\">Open Web Application Security Project (OWASP) Guide</a>.</p>\n\n<p translation-result=\"on\">你可以运行<live-example></live-example>，在 Stackblitz 中试用并下载本页的代码。</p><p translation-origin=\"off\">You can run the <live-example></live-example> in Stackblitz and download the code from there.</p>\n\n<p><a id=\"report-issues\"></a></p>\n<div class=\"callout is-important\">\n<header ng-should-translate=\"\" translation-result=\"on\">举报漏洞</header><header ng-should-translate=\"\" translation-origin=\"off\">Reporting vulnerabilities</header>\n\n<p translation-result=\"on\">Angular 是 Google 的<a href=\"https://bughunters.google.com/about/rules/6521337925468160/google-open-source-software-vulnerability-reward-program-rules\">开源软件漏洞奖励项目</a>的一部分，对于 Angular 中的漏洞，请把报告提交到<a href=\"https://bughunters.google.com/report\">这里</a>。</p><p translation-origin=\"off\">Angular is part of Google <a href=\"https://bughunters.google.com/about/rules/6521337925468160/google-open-source-software-vulnerability-reward-program-rules\">Open Source Software Vulnerability Reward Program</a>, for vulnerabilities in Angular please submit your report <a href=\"https://bughunters.google.com/report\">here</a>.</p>\n\n<p translation-result=\"on\">要了解关于“谷歌如何处理安全问题”的更多信息，参阅<a href=\"https://www.google.com/about/appsecurity/\">谷歌的安全哲学</a>。</p><p translation-origin=\"off\">For more information about how Google handles security issues, see <a href=\"https://www.google.com/about/appsecurity\">Google's security philosophy</a>.</p>\n\n</div>\n<p><a id=\"best-practices\"></a></p>\n<div class=\"callout is-helpful\">\n<header ng-should-translate=\"\" translation-result=\"on\">最佳实践</header><header ng-should-translate=\"\" translation-origin=\"off\">Best practices</header>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\"><nt-wrapper translation-result=\"on\">实践</nt-wrapper><nt-wrapper translation-origin=\"off\">Practices</nt-wrapper></th>\n<th align=\"left\"><nt-wrapper translation-result=\"on\">详情</nt-wrapper><nt-wrapper translation-origin=\"off\">Details</nt-wrapper></th>\n</tr>\n</thead>\n<tbody>\n\n<tr>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">及时把 Angular 包更新到最新版本</nt-wrapper><nt-wrapper translation-origin=\"off\">Keep current with the latest Angular library releases</nt-wrapper></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">我们会频繁的更新 Angular 库，这些更新可能会修复之前版本中发现的安全漏洞。查看 Angular 的<a href=\"https://github.com/angular/angular/blob/main/CHANGELOG.md\">更新记录</a>，了解与安全有关的更新。</nt-wrapper><nt-wrapper translation-origin=\"off\">The Angular libraries get regular updates, and these updates might fix security defects discovered in previous versions. Check the Angular <a href=\"https://github.com/angular/angular/blob/main/CHANGELOG.md\">change log</a> for security-related updates.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">不要修改你的 Angular 副本</nt-wrapper><nt-wrapper translation-origin=\"off\">Don't alter your copy of Angular</nt-wrapper></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">私有的、定制版的 Angular 往往跟不上最新版本，这可能导致你忽略重要的安全修复与增强。反之，应该在社区共享你对 Angular 所做的改进并创建 Pull Request。.</nt-wrapper><nt-wrapper translation-origin=\"off\">Private, customized versions of Angular tend to fall behind the current version and might not include important security fixes and enhancements. Instead, share your Angular improvements with the community and make a pull request.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">避免使用本文档中带“<a href=\"guide/security#bypass-security-apis\"><em>安全风险</em></a>”标记的 Angular API</nt-wrapper><nt-wrapper translation-origin=\"off\">Avoid Angular APIs marked in the documentation as \"<em>Security Risk</em>\"</nt-wrapper></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">要了解更多信息，请参阅本章的<a href=\"guide/security#bypass-security-apis\">信任那些安全的值</a>部分。</nt-wrapper><nt-wrapper translation-origin=\"off\">For more information, see the <a href=\"guide/security#bypass-security-apis\">Trusting safe values</a> section of this page.</nt-wrapper></td>\n</tr>\n\n</tbody>\n</table>\n</div>\n<h2 id=\"preventing-cross-site-scripting-xss\" translation-result=\"on\">防范跨站脚本(XSS)攻击<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#preventing-cross-site-scripting-xss\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\">Preventing cross-site scripting (XSS)<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#preventing-cross-site-scripting-xss\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\"><a href=\"https://en.wikipedia.org/wiki/Cross-site_scripting\">跨站脚本(XSS)</a>允许攻击者将恶意代码注入到页面中。这些代码可以偷取用户及其登录数据数据，还可以冒充用户执行操作。它是 Web 上最常见的攻击方式之一。</p><p translation-origin=\"off\"><a href=\"https://en.wikipedia.org/wiki/Cross-site_scripting\">Cross-site scripting (XSS)</a> enables attackers to inject malicious code into web pages.\nSuch code can then, for example, steal user and login data, or perform actions that impersonate the user.\nThis is one of the most common attacks on the web.</p>\n\n<p translation-result=\"on\">为了防范 XSS 攻击，你必须阻止恶意代码进入 DOM。比如，如果某个攻击者能骗你把 <code>&lt;script&gt;</code> 标签插入到 DOM，就可以在你的网站上运行任何代码。除了 <code>&lt;script&gt;</code>，攻击者还可以使用很多 DOM 元素和属性来执行代码，比如 <code>&lt;<a href=\"api/common/NgOptimizedImage\" class=\"code-anchor\">img</a> alt=\"\" onerror=\"...\"&gt;</code>、<code>&lt;a href=\"javascript:...\"&gt;</code>。如果攻击者所控制的数据混进了 DOM，就会导致安全漏洞。</p><p translation-origin=\"off\">To block XSS attacks, you must prevent malicious code from entering the Document Object Model (DOM).\nFor example, if attackers can trick you into inserting a <code>&lt;script&gt;</code> tag in the DOM, they can run arbitrary code on your website.\nThe attack isn't limited to <code>&lt;script&gt;</code> tags —many elements and properties in the DOM allow code execution, for example, <code>&lt;<a href=\"api/common/NgOptimizedImage\" class=\"code-anchor\">img</a> alt=\"\" onerror=\"...\"&gt;</code> and <code>&lt;a href=\"javascript:...\"&gt;</code>.\nIf attacker-controlled data enters the DOM, expect security vulnerabilities.</p>\n\n<h3 id=\"angulars-cross-site-scripting-security-model\" translation-result=\"on\">Angular 的“跨站脚本安全模型”<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#angulars-cross-site-scripting-security-model\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Angular's cross-site scripting security model<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#angulars-cross-site-scripting-security-model\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">为了系统性的防范 XSS 问题，Angular 默认把所有值都当做不可信任的。\n当值从模板中以属性（Property）、DOM 元素属性（Attribte)、CSS 类绑定或插值等途径插入到 DOM 中的时候，\nAngular 将对这些值进行无害化处理（Sanitize），对不可信的值进行编码。如果某个值已经在 Angular 之外进行过无害化处理，可以确信是安全的，可以<a href=\"guide/security#bypass-security-apis\">把这个值标记为安全的</a>来把这一点通知 Angular。</p><p translation-origin=\"off\">To systematically block XSS bugs, Angular treats all values as untrusted by default.\nWhen a value is inserted into the DOM from a template binding, or interpolation, Angular sanitizes and escapes untrusted values.\nIf a value was already sanitized outside of Angular and is considered safe, communicate this to Angular by marking the <a href=\"guide/security#bypass-security-apis\">value as trusted</a>.</p>\n\n<p translation-result=\"on\">与用于渲染的值不同，默认情况下，Angular 模板被认为是受信任的，应被视为可执行代码。切勿通过串联用户输入和模板语法来生成模板。这样做会使攻击者能够<a href=\"https://en.wikipedia.org/wiki/Code_injection\">将任意代码注入</a>你的应用程序。为避免这些漏洞，请始终在生产部署中<a href=\"guide/security#offline-template-compiler\">使用默认的 AOT 模板编译器。</a>。</p><p translation-origin=\"off\">Unlike values to be used for rendering, Angular templates are considered trusted by default, and should be treated as executable code.\nNever create templates by concatenating user input and template syntax.\nDoing this would enable attackers to <a href=\"https://en.wikipedia.org/wiki/Code_injection\">inject arbitrary code</a> into your application.\nTo prevent these vulnerabilities, always use the default <a href=\"guide/security#offline-template-compiler\">Ahead-Of-Time (AOT) template compiler</a> in production deployments.</p>\n\n<p translation-result=\"on\">借助内容安全策略和可信类型，可以提供额外的保护层。这些 Web 平台特性会在 DOM 级别运行，这是用来防范 XSS 问题的最有效位置，因为即使使用其它低级 API 也无法绕过它们。出于这个原因，我们强烈建议开发人员通过为其应用程序配置<a href=\"guide/security#content-security-policy\">内容安全策略</a>并启用<a href=\"guide/security#trusted-types\">强制可信类型</a>来利用这些特性。</p><p translation-origin=\"off\">An extra layer of protection can be provided through the use of Content security policy and Trusted Types.\nThese web platform features operate at the DOM level which is the most effective place to prevent XSS issues. Here they can't be bypassed using other, lower-level APIs.\nFor this reason, it is strongly encouraged to take advantage of these features. To do this, configure the <a href=\"guide/security#content-security-policy\">content security policy</a> for the application and enable <a href=\"guide/security#trusted-types\">trusted types enforcement</a>.</p>\n\n<h3 id=\"sanitization-and-security-contexts\" translation-result=\"on\">无害化处理与安全环境<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#sanitization-and-security-contexts\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Sanitization and security contexts<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#sanitization-and-security-contexts\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">无害化处理会审查不可信的值，并将它们转换成可以安全插入到 DOM 的形式。多数情况下，这些值并不会在处理过程中发生任何变化。无害化处理的方式取决于所在的环境：一个在 CSS 里面无害的值，可能在 URL 里很危险。</p><p translation-origin=\"off\"><em>Sanitization</em> is the inspection of an untrusted value, turning it into a value that's safe to insert into the DOM.\nIn many cases, sanitization doesn't change a value at all.\nSanitization depends on context:\nA value that's harmless in CSS is potentially dangerous in a URL.</p>\n\n<p translation-result=\"on\">Angular 定义了四个安全环境：</p><p translation-origin=\"off\">Angular defines the following security contexts:</p>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\"><nt-wrapper translation-result=\"on\">安全上下文</nt-wrapper><nt-wrapper translation-origin=\"off\">Security contexts</nt-wrapper></th>\n<th align=\"left\"><nt-wrapper translation-result=\"on\">详情</nt-wrapper><nt-wrapper translation-origin=\"off\">Details</nt-wrapper></th>\n</tr>\n</thead>\n<tbody>\n\n<tr>\n<td align=\"left\">HTML</td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">值需要被解释为 HTML 时使用，比如当绑定到 <code>innerHTML</code> 时。</nt-wrapper><nt-wrapper translation-origin=\"off\">Used when interpreting a value as HTML, for example, when binding to <code>innerHtml</code>.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">样式</nt-wrapper><nt-wrapper translation-origin=\"off\">Style</nt-wrapper></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">值需要作为 CSS 绑定到 <code><a href=\"api/animations/style\" class=\"code-anchor\">style</a></code> 属性时使用。</nt-wrapper><nt-wrapper translation-origin=\"off\">Used when binding CSS into the <code><a href=\"api/animations/style\" class=\"code-anchor\">style</a></code> property.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\">URL</td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">值需要被用作 URL 属性时使用，比如 <code>&lt;a href&gt;</code>。</nt-wrapper><nt-wrapper translation-origin=\"off\">Used for URL properties, such as <code>&lt;a href&gt;</code>.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">资源 URL</nt-wrapper><nt-wrapper translation-origin=\"off\">Resource URL</nt-wrapper></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">值需要作为代码进行加载并执行，比如 <code>&lt;script src&gt;</code> 中的 URL。</nt-wrapper><nt-wrapper translation-origin=\"off\">A URL that is loaded and executed as code, for example, in <code>&lt;script src&gt;</code>.</nt-wrapper></td>\n</tr>\n\n</tbody>\n</table>\n<p translation-result=\"on\">Angular 会对前三项中种不可信的值进行无害化处理，但不能对第四种资源 URL 进行无害化，因为它们可能包含任何代码。在开发模式下，如果在进行无害化处理时需要被迫改变一个值，Angular 就会在控制台上输出一个警告。</p><p translation-origin=\"off\">Angular sanitizes untrusted values for HTML, styles, and URLs. Sanitizing resource URLs isn't possible because they contain arbitrary code.\nIn development mode, Angular prints a console warning when it has to change a value during sanitization.</p>\n\n<h3 id=\"sanitization-example\" translation-result=\"on\">无害化范例<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#sanitization-example\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Sanitization example<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#sanitization-example\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">下面的例子绑定了 <code>htmlSnippet</code> 的值。一次把它放进插值里，另一次把它绑定到元素的 <code>innerHTML</code> 属性上。</p><p translation-origin=\"off\">The following template binds the value of <code>htmlSnippet</code>. Once by interpolating it into an element's content, and once by binding it to the <code>innerHTML</code> property of an element:</p>\n\n<code-example header=\"src/app/inner-html-binding.component.html\" path=\"security/src/app/inner-html-binding.component.html\">\n&lt;h3&gt;Binding innerHTML&lt;/h3&gt;\n&lt;p&gt;Bound value:&lt;/p&gt;\n&lt;p class=\"e2e-inner-html-interpolated\"&gt;{{htmlSnippet}}&lt;/p&gt;\n&lt;p&gt;Result of binding to innerHTML:&lt;/p&gt;\n&lt;p class=\"e2e-inner-html-bound\" [innerHTML]=\"htmlSnippet\"&gt;&lt;/p&gt;\n\n\n</code-example>\n<p translation-result=\"on\">插值的内容总会被编码 - 其中的 HTML 不会被解释，所以浏览器会在元素的文本内容中显示尖括号。</p><p translation-origin=\"off\">Interpolated content is always escaped —the HTML isn't interpreted and the browser displays angle brackets in the element's text content.</p>\n\n<p translation-result=\"on\">如果希望这段 HTML 被正常解释，就必须绑定到一个 HTML 属性上，比如 <code>innerHTML</code>。但要小心如果把一个可能被攻击者控制的值绑定到 <code>innerHTML</code> 就会导致 XSS 漏洞。比如，某些人可以用这种方式来执行恶意代码：</p><p translation-origin=\"off\">For the HTML to be interpreted, bind it to an HTML property such as <code>innerHTML</code>.\nBe aware that binding a value that an attacker might control into <code>innerHTML</code> normally causes an XSS vulnerability.\nFor example, one could run JavaScript in a following way:</p>\n\n<code-example header=\"src/app/inner-html-binding.component.ts (class)\" path=\"security/src/app/inner-html-binding.component.ts\" region=\"class\">\nexport class InnerHtmlBindingComponent {\n  // For example, a user/attacker-controlled value from a URL.\n  htmlSnippet = 'Template &lt;script&gt;alert(\"0wned\")&lt;/script&gt; &lt;b&gt;Syntax&lt;/b&gt;';\n}\n\n\n</code-example>\n<p translation-result=\"on\">Angular 认为这些值是不安全的，并自动进行无害化处理。它会移除 <code>script</code> 元素，但保留安全的内容，比如该片段中的 <code>&lt;b&gt;</code> 元素。</p><p translation-origin=\"off\">Angular recognizes the value as unsafe and automatically sanitizes it, which removes the <code>script</code> element but keeps safe content such as the <code>&lt;b&gt;</code> element.</p>\n\n<div class=\"lightbox\">\n<img alt=\"A screenshot showing interpolated and bound HTML values\" src=\"generated/images/guide/security/binding-inner-html.png\" width=\"400\" height=\"114\">\n</div>\n<h3 id=\"direct-use-of-the-dom-apis-and-explicit-sanitization-calls\" translation-result=\"on\">避免直接使用 DOM API<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#direct-use-of-the-dom-apis-and-explicit-sanitization-calls\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Direct use of the DOM APIs and explicit sanitization calls<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#direct-use-of-the-dom-apis-and-explicit-sanitization-calls\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">除非你强制使用可信类型（Trusted Types），否则浏览器内置的 DOM API 不会自动保护你免受安全漏洞的侵害。比如 <code>document</code>、通过 <code><a href=\"api/core/ElementRef\" class=\"code-anchor\">ElementRef</a></code> 拿到的节点和很多第三方 API，都可能包含不安全的方法。如果你使用能操纵 DOM 的其它库，也同样无法借助像 Angular 插值那样的自动清理功能。所以，要避免直接和 DOM 打交道，而是尽可能使用 Angular 模板。</p><p translation-origin=\"off\">Unless you enforce Trusted Types, the built-in browser DOM APIs don't automatically protect you from security vulnerabilities.\nFor example, <code>document</code>, the node available through <code><a href=\"api/core/ElementRef\" class=\"code-anchor\">ElementRef</a></code>, and many third-party APIs contain unsafe methods.\nLikewise, if you interact with other libraries that manipulate the DOM, you likely won't have the same automatic sanitization as with Angular interpolations.\nAvoid directly interacting with the DOM and instead use Angular templates where possible.</p>\n\n<p translation-result=\"on\">在无法避免的情况下，使用内置的 Angular 无害化处理函数。使用 <a href=\"api/platform-browser/DomSanitizer#sanitize\">DomSanitizer.sanitize</a> 方法以及适当的 <code><a href=\"api/core/SecurityContext\" class=\"code-anchor\">SecurityContext</a></code> 来对不可信的值进行无害化处理。此函数也可以接受使用 <code>bypassSecurityTrust</code> 函数标为可信的值，而且不会对它们进行无害化处理，就像<a href=\"guide/security#bypass-security-apis\">稍后讲的那样</a>。</p><p translation-origin=\"off\">For cases where this is unavoidable, use the built-in Angular sanitization functions.\nSanitize untrusted values with the <a href=\"api/platform-browser/DomSanitizer#sanitize\">DomSanitizer.sanitize</a> method and the appropriate <code><a href=\"api/core/SecurityContext\" class=\"code-anchor\">SecurityContext</a></code>.\nThat function also accepts values that were marked as trusted using the <code>bypassSecurityTrust</code> … functions, and does not sanitize them, as <a href=\"guide/security#bypass-security-apis\">described below</a>.</p>\n\n<p><a id=\"bypass-security-apis\"></a></p>\n<h3 id=\"trusting-safe-values\" translation-result=\"on\">信任安全值<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#trusting-safe-values\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Trusting safe values<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#trusting-safe-values\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">有时候，应用程序确实需要包含可执行的代码，比如使用 URL 显示 <code>&lt;iframe&gt;</code>，或者构造出有潜在危险的 URL。为了防止在这种情况下被自动无害化，可以告诉 Angular，你已经审查了这个值，检查了它是怎么生成的，并确信它总是安全的。但是<strong>千万要小心</strong>！如果你信任了一个可能是恶意的值，就会在应用中引入一个安全漏洞。如果你有疑问，请找一个安全专家复查下。</p><p translation-origin=\"off\">Sometimes applications genuinely need to include executable code, display an <code>&lt;iframe&gt;</code> from some URL, or construct potentially dangerous URLs.\nTo prevent automatic sanitization in these situations, tell Angular that you inspected a value, checked how it was created, and made sure it is secure.\nDo <em>be careful</em>.\nIf you trust a value that might be malicious, you are introducing a security vulnerability into your application.\nIf in doubt, find a professional security reviewer.</p>\n\n<p translation-result=\"on\">注入 <code><a href=\"api/platform-browser/DomSanitizer\" class=\"code-anchor\">DomSanitizer</a></code> 服务，然后调用下面的方法之一，你就可以把一个值标记为可信任的。</p><p translation-origin=\"off\">To mark a value as trusted, inject <code><a href=\"api/platform-browser/DomSanitizer\" class=\"code-anchor\">DomSanitizer</a></code> and call one of the following methods:</p>\n\n<ul>\n<li>\n<p><code>bypassSecurityTrustHtml</code></p>\n</li>\n<li>\n<p><code>bypassSecurityTrustScript</code></p>\n</li>\n<li>\n<p><code>bypassSecurityTrustStyle</code></p>\n</li>\n<li>\n<p><code>bypassSecurityTrustUrl</code></p>\n</li>\n<li>\n<p><code>bypassSecurityTrustResourceUrl</code></p>\n</li>\n</ul>\n<p translation-result=\"on\">记住，一个值是否安全取决于它所在的环境，所以你要为这个值按预定的用法选择正确的环境。假设下面的模板需要把 <code>javascript.alert(...)</code> 方法绑定到 URL。</p><p translation-origin=\"off\">Remember, whether a value is safe depends on context, so choose the right context for your intended use of the value.\nImagine that the following template needs to bind a URL to a <code>javascript:alert(...)</code> call:</p>\n\n<code-example header=\"src/app/bypass-security.component.html (URL)\" path=\"security/src/app/bypass-security.component.html\" region=\"URL\">\n&lt;h4&gt;An untrusted URL:&lt;/h4&gt;\n&lt;p&gt;&lt;a class=\"e2e-dangerous-url\" [href]=\"dangerousUrl\"&gt;Click me&lt;/a&gt;&lt;/p&gt;\n&lt;h4&gt;A trusted URL:&lt;/h4&gt;\n&lt;p&gt;&lt;a class=\"e2e-trusted-url\" [href]=\"trustedUrl\"&gt;Click me&lt;/a&gt;&lt;/p&gt;\n\n</code-example>\n<p translation-result=\"on\">通常，Angular 会自动无害化这个 URL 并禁止危险的代码。为了防止这种行为，可以调用 <code>bypassSecurityTrustUrl</code> 把这个 URL 值标记为一个可信任的 URL：</p><p translation-origin=\"off\">Normally, Angular automatically sanitizes the URL, disables the dangerous code, and in development mode, logs this action to the console.\nTo prevent this, mark the URL value as a trusted URL using the <code>bypassSecurityTrustUrl</code> call:</p>\n\n<code-example header=\"src/app/bypass-security.component.ts (trust-url)\" path=\"security/src/app/bypass-security.component.ts\" region=\"trust-url\">\nconstructor(private sanitizer: <a href=\"api/platform-browser/DomSanitizer\" class=\"code-anchor\">DomSanitizer</a>) {\n  // javascript: URLs are dangerous if attacker controlled.\n  // Angular sanitizes them in data binding, but you can\n  // explicitly tell Angular to trust this value:\n  this.dangerousUrl = 'javascript:alert(\"Hi there\")';\n  this.trustedUrl = sanitizer.bypassSecurityTrustUrl(this.dangerousUrl);\n\n</code-example>\n<div class=\"lightbox\">\n<img alt=\"A screenshot showing an alert box created from a trusted URL\" src=\"generated/images/guide/security/bypass-security-component.png\" width=\"454\" height=\"175\">\n</div>\n<p translation-result=\"on\">如果需要把用户输入转换为一个可信任的值，可以在组件方法中处理。下面的模板允许用户输入一个 YouTube 视频的 ID，然后把相应的视频加载到 <code>&lt;iframe&gt;</code> 中。<code>&lt;iframe src&gt;</code> 是一个“资源 URL”的安全环境，因为不可信的源码可能作为文件下载到本地，被毫无防备的用户执行。所以要调用一个组件方法来构造一个新的、可信任的视频 URL，这样 Angular 就会允许把它绑定到 <code>&lt;iframe src&gt;</code>。</p><p translation-origin=\"off\">If you need to convert user input into a trusted value, use a component method.\nThe following template lets users enter a YouTube video ID and load the corresponding video in an <code>&lt;iframe&gt;</code>.\nThe <code>&lt;iframe src&gt;</code> attribute is a resource URL security context, because an untrusted source can, for example, smuggle in file downloads that unsuspecting users could run.\nTo prevent this, call a method on the component to construct a trusted video URL, which causes Angular to let binding into <code>&lt;iframe src&gt;</code>:</p>\n\n<code-example header=\"src/app/bypass-security.component.html (iframe)\" path=\"security/src/app/bypass-security.component.html\" region=\"iframe\">\n&lt;h4&gt;Resource URL:&lt;/h4&gt;\n&lt;p&gt;Showing: {{dangerousVideoUrl}}&lt;/p&gt;\n&lt;p&gt;Trusted:&lt;/p&gt;\n&lt;iframe class=\"e2e-iframe-trusted-src\" width=\"640\" height=\"390\" [src]=\"videoUrl\"&gt;&lt;/iframe&gt;\n&lt;p&gt;Untrusted:&lt;/p&gt;\n&lt;iframe class=\"e2e-iframe-untrusted-src\" width=\"640\" height=\"390\" [src]=\"dangerousVideoUrl\"&gt;&lt;/iframe&gt;\n\n\n</code-example>\n<code-example header=\"src/app/bypass-security.component.ts (trust-video-url)\" path=\"security/src/app/bypass-security.component.ts\" region=\"trust-video-url\">\nupdateVideoUrl(id: string) {\n  // Appending an ID to a YouTube URL is safe.\n  // Always make sure to construct <a href=\"api/platform-browser/SafeValue\" class=\"code-anchor\">SafeValue</a> objects as\n  // close as possible to the input data so\n  // that it's easier to check if the value is safe.\n  this.dangerousVideoUrl = 'https://www.youtube.com/embed/' + id;\n  this.videoUrl =\n      this.sanitizer.bypassSecurityTrustResourceUrl(this.dangerousVideoUrl);\n}\n\n</code-example>\n<p><a id=\"content-security-policy\"></a></p>\n<h3 id=\"content-security-policy\" translation-result=\"on\">内容安全政策<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#content-security-policy\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Content security policy<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#content-security-policy\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">内容安全策略（CSP）是防止 XSS 的深度防御技术。要启用 CSP，请将你的 Web 服务器配置为返回适当的 <code>Content-Security-Policy</code> HTTP 请求头。在 Google Developers 网站上的<a href=\"https://developers.google.com/web/fundamentals/security/csp\">《网络基础知识》指南</a>中了解有关内容安全政策的更多信息。</p><p translation-origin=\"off\">Content Security Policy (CSP) is a defense-in-depth technique to prevent XSS.\nTo enable CSP, configure your web server to return an appropriate <code>Content-Security-Policy</code> HTTP header.\nRead more about content security policy at the <a href=\"https://developers.google.com/web/fundamentals/security/csp\">Web Fundamentals guide</a> on the Google Developers website.</p>\n\n<p translation-result=\"on\">新版 Angular 所需的最小化策略是：</p><p translation-origin=\"off\">The minimal policy required for brand-new Angular is:</p>\n\n<code-example format=\"none\" language=\"none\">\n\ndefault-src 'self'; style-src 'self' 'unsafe-inline';\n\n</code-example>\n<table>\n<thead>\n<tr>\n<th align=\"left\"><nt-wrapper translation-result=\"on\">区段</nt-wrapper><nt-wrapper translation-origin=\"off\">Sections</nt-wrapper></th>\n<th align=\"left\"><nt-wrapper translation-result=\"on\">详情</nt-wrapper><nt-wrapper translation-origin=\"off\">Details</nt-wrapper></th>\n</tr>\n</thead>\n<tbody>\n\n<tr>\n<td align=\"left\"><code>default-src 'self';</code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">允许此页面加载所有来自同源的资源。</nt-wrapper><nt-wrapper translation-origin=\"off\">Allows the page to load all its required resources from the same origin.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><code>style-src 'self' 'unsafe-inline';</code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">允许此页面加载来自同源的全局样式(<code>'self'</code>)，并允许组件加载它们的样式(<code>'unsafe-inline'</code> - 参见 <a href=\"https://github.com/angular/angular/issues/6361\"><code>angular/angular#6361</code></a>)。</nt-wrapper><nt-wrapper translation-origin=\"off\">Allows the page to load global styles from the same origin (<code>'self'</code>) and enables components to load their styles (<code>'unsafe-inline'</code> - see <a href=\"https://github.com/angular/angular/issues/6361\"><code>angular/angular#6361</code></a>).</nt-wrapper></td>\n</tr>\n\n</tbody>\n</table>\n<p translation-result=\"on\">Angular 本身只需要这些设置即可正常运行。随着项目的增长，你可能需要将 CSP 设置扩展出应用特有的一些额外特性。</p><p translation-origin=\"off\">Angular itself requires only these settings to function correctly.\nAs your project grows, you may need to expand your CSP settings to accommodate extra features specific to your application.</p>\n\n<p><a id=\"trusted-types\"></a></p>\n<!-- vale Angular.Google_Headings = NO -->\n<h3 id=\"enforcing-trusted-types\" translation-result=\"on\">强制执行可信类型<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#enforcing-trusted-types\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Enforcing Trusted Types<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#enforcing-trusted-types\"><i class=\"material-icons\">link</i></a></h3>\n\n<!-- vale Angular.Google_Headings = YES -->\n<p translation-result=\"on\">建议使用<a href=\"https://w3c.github.io/webappsec-trusted-types/dist/spec\">可信类型</a>来帮助保护你的应用程序免受跨站脚本攻击。可信类型是一项 <a href=\"https://en.wikipedia.org/wiki/Web_platform\">Web 平台</a>功能，可通过实施更安全的编码实践来帮助你防范跨站脚本攻击。可信类型还可以帮助简化应用程序代码的审计。</p><p translation-origin=\"off\">It is recommended that you use <a href=\"https://w3c.github.io/webappsec-trusted-types/dist/spec\">Trusted Types</a> as a way to help secure your applications from cross-site scripting attacks.\nTrusted Types is a <a href=\"https://en.wikipedia.org/wiki/Web_platform\">web platform</a> feature that can help you prevent cross-site scripting attacks by enforcing safer coding practices.\nTrusted Types can also help simplify the auditing of application code.</p>\n\n<div class=\"callout is-helpful\">\n<p translation-result=\"on\">可信类型可能尚未在你的应用程序目标的所有浏览器中可用。如果启用了可信类型的应用程序在不支持可信类型的浏览器中运行，应用程序的功能将被保留，并且你的应用程序将通过 Angular 的 DomSanitizer 防范 XSS。有关当前浏览器支持，请参阅 <a href=\"https://caniuse.com/trusted-types\">caniuse.com/trusted-types</a>。</p><p translation-origin=\"off\">Trusted Types might not yet be available in all browsers your application targets.\nIn the case your Trusted-Types-enabled application runs in a browser that doesn't support Trusted Types, the features of the application are preserved. Your application is guarded against XSS by way of Angular's DomSanitizer.\nSee <a href=\"https://caniuse.com/trusted-types\">caniuse.com/trusted-types</a> for the current browser support.</p>\n\n</div>\n<p translation-result=\"on\">要为你的应用程序强制实施可信类型，你必须将应用程序的 Web 服务器配置为使用以下 Angular 策略之一发出 HTTP 请求头：</p><p translation-origin=\"off\">To enforce Trusted Types for your application, you must configure your application's web server to emit HTTP headers with one of the following Angular policies:</p>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\"><nt-wrapper translation-result=\"on\">策略</nt-wrapper><nt-wrapper translation-origin=\"off\">Policies</nt-wrapper></th>\n<th align=\"left\"><nt-wrapper translation-result=\"on\">详情</nt-wrapper><nt-wrapper translation-origin=\"off\">Detail</nt-wrapper></th>\n</tr>\n</thead>\n<tbody>\n\n<tr>\n<td align=\"left\"><code>angular</code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">此策略用于 Angular 内部经过安全审查的代码，并且当强制执行可信类型时，Angular 需要此策略才能正常运行。任何由 Angular 清理的内联模板值或内容都被此政策视为安全的。</nt-wrapper><nt-wrapper translation-origin=\"off\">This policy is used in security-reviewed code that is internal to Angular, and is required for Angular to function when Trusted Types are enforced. Any inline template values or content sanitized by Angular is treated as safe by this policy.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><code>angular#unsafe-bypass</code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">此策略用于要使用 Angular 的 <a href=\"api/platform-browser/DomSanitizer\">DomSanitizer</a> 的各个方法来绕过安全性的应用程序，比如 <code>bypassSecurityTrustHtml</code>。任何使用了这些方法的应用程序都必须启用此策略。</nt-wrapper><nt-wrapper translation-origin=\"off\">This policy is used for applications that use any of the methods in Angular's <a href=\"api/platform-browser/DomSanitizer\">DomSanitizer</a> that bypass security, such as <code>bypassSecurityTrustHtml</code>. Any application that uses these methods must enable this policy.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><code>angular#unsafe-jit</code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">此策略供<a href=\"api/core/Compiler\">Just-In-Time (JIT) 编译器</a>使用。如果你的应用程序直接与 JIT 编译器交互或使用<a href=\"api/platform-browser-dynamic/platformBrowserDynamic\">平台浏览器动态</a>以 JIT 模式运行，你必须启用此策略。</nt-wrapper><nt-wrapper translation-origin=\"off\">This policy is used by the <a href=\"api/core/Compiler\">Just-In-Time (JIT) compiler</a>. You must enable this policy if your application interacts directly with the JIT compiler or is running in JIT mode using the <a href=\"api/platform-browser-dynamic/platformBrowserDynamic\">platform browser dynamic</a>.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><code>angular#bundler</code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">创建惰性加载块文件时，Angular CLI 打包器会使用此策略。</nt-wrapper><nt-wrapper translation-origin=\"off\">This policy is used by the Angular CLI bundler when creating lazy chunk files.</nt-wrapper></td>\n</tr>\n\n</tbody>\n</table>\n<p translation-result=\"on\">你应该在以下位置为可信类型配置 HTTP 请求头：</p><p translation-origin=\"off\">You should configure the HTTP headers for Trusted Types in the following locations:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\">生产环境基础设施服务器</p><p translation-origin=\"off\">Production serving infrastructure</p>\n\n</li>\n<li>\n<p translation-result=\"on\">Angular CLI ( <code>ng serve</code> )，使用 <code>angular.json</code> 文件中的 <code>headers</code> 属性，用于本地开发和端到端测试</p><p translation-origin=\"off\">Angular CLI (<code>ng serve</code>), using the <code>headers</code> property in the <code>angular.json</code> file, for local development and end-to-end testing</p>\n\n</li>\n<li>\n<p translation-result=\"on\">Karma ( <code>ng test</code> )，使用 <code>karma.config.js</code> 文件中的 <code>customHeaders</code> 属性，进行单元测试</p><p translation-origin=\"off\">Karma (<code>ng test</code>), using the <code>customHeaders</code> property in the <code>karma.config.js</code> file, for unit testing</p>\n\n</li>\n</ul>\n<p translation-result=\"on\">以下是为可信类型和 Angular 配置的请求头示例：</p><p translation-origin=\"off\">The following is an example of a header specifically configured for Trusted Types and Angular:</p>\n\n<code-example format=\"html\" language=\"html\">\n\nContent-Security-Policy: trusted-types angular; require-trusted-types-for 'script';\n\n</code-example>\n<p translation-result=\"on\">以下是为可信类型和 Angular 应用程序专门配置的请求头示例，这些应用程序使用了 Angular <a href=\"api/platform-browser/DomSanitizer\">DomSanitizer</a> 中那些可以绕过安全性的方法。</p><p translation-origin=\"off\">An example of a header specifically configured for Trusted Types and Angular applications that use any of Angular's methods in <a href=\"api/platform-browser/DomSanitizer\">DomSanitizer</a> that bypasses security:</p>\n\n<code-example format=\"html\" language=\"html\">\n\nContent-Security-Policy: trusted-types angular angular#unsafe-bypass; require-trusted-types-for 'script';\n\n</code-example>\n<p translation-result=\"on\">以下是使用 JIT，且专门为可信类型和 Angular 应用程序配置的请求头示例：</p><p translation-origin=\"off\">The following is an example of a header specifically configured for Trusted Types and Angular applications using JIT:</p>\n\n<code-example format=\"html\" language=\"html\">\n\nContent-Security-Policy: trusted-types angular angular#unsafe-jit; require-trusted-types-for 'script';\n\n</code-example>\n<p translation-result=\"on\">以下是专门为使用惰性加载模块的受信任类型和 Angular 应用程序配置的标头示例：</p><p translation-origin=\"off\">The following is an example of a header specifically configured for Trusted Types and Angular applications that use lazy loading of modules:</p>\n\n<code-example language=\"html\">\n\nContent-Security-Policy: trusted-types angular angular#bundler; require-trusted-types-for 'script';\n\n</code-example>\n<div class=\"callout is-helpful\">\n<header ng-should-translate=\"\" translation-result=\"on\">社区贡献</header><header ng-should-translate=\"\" translation-origin=\"off\">Community contributions</header>\n\n<p translation-result=\"on\">要了解关于如何对可信类型配置进行故障排除的更多信息，以下资源可能会有所帮助：</p><p translation-origin=\"off\">To learn more about troubleshooting Trusted Type configurations, the following resource might be helpful:</p>\n\n<p translation-result=\"on\"><a href=\"https://web.dev/trusted-types/#how-to-use-trusted-types\">使用可信类型防范基于 DOM 的跨站脚本漏洞</a></p><p translation-origin=\"off\"><a href=\"https://web.dev/trusted-types/#how-to-use-trusted-types\">Prevent DOM-based cross-site scripting vulnerabilities with Trusted Types</a></p>\n\n</div>\n<p><a id=\"offline-template-compiler\"></a></p>\n<h3 id=\"use-the-aot-template-compiler\" translation-result=\"on\">使用 AOT 模板编译器<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#use-the-aot-template-compiler\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Use the AOT template compiler<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#use-the-aot-template-compiler\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">AOT 模板编译器可防止称为模板注入的一整类漏洞，并大大提高了应用程序性能。AOT 模板编译器是 Angular CLI 应用程序使用的默认编译器，你应该在所有生产部署中使用它。</p><p translation-origin=\"off\">The AOT template compiler prevents a whole class of vulnerabilities called template injection, and greatly improves application performance.\nThe AOT template compiler is the default compiler used by Angular CLI applications, and you should use it in all production deployments.</p>\n\n<p translation-result=\"on\">AOT 编译器的替代方法是 JIT 编译器，它可以在运行时将模板编译为浏览器中的可执行模板代码。Angular 信任这些模板代码，因此动态生成模板并进行编译（尤其是包含用户数据的模板）可以规避 Angular 的内置保护就。这是一种安全性方面的反模式。要了解如何以安全方式动态构建表单，请参见<a href=\"guide/dynamic-form\">《动态表单》</a>指南。</p><p translation-origin=\"off\">An alternative to the AOT compiler is the JIT compiler which compiles templates to executable template code within the browser at runtime.\nAngular trusts template code, so dynamically generating templates and compiling them, in particular templates containing user data, circumvents Angular's built-in protections. This is a security anti-pattern.\nFor information about dynamically constructing forms in a safe way, see the <a href=\"guide/dynamic-form\">Dynamic Forms</a> guide.</p>\n\n<p><a id=\"server-side-xss\"></a></p>\n<h3 id=\"server-side-xss-protection\" translation-result=\"on\">服务器端 XSS 保护<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#server-side-xss-protection\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Server-side XSS protection<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#server-side-xss-protection\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">在服务器上构造的 HTML 容易受到注入攻击。将模板代码注入到 Angular 应用程序中与注入可执行代码是一样的：它使攻击者可以完全控制该应用程序。为避免这种情况，请使用一种模板语言来自动转义值以防止服务器上的 XSS 漏洞。不要在服务器端使用模板语言生成 Angular 模板。这样做会带来引入模板注入漏洞的高风险。</p><p translation-origin=\"off\">HTML constructed on the server is vulnerable to injection attacks.\nInjecting template code into an Angular application is the same as injecting executable code into the application:\nIt gives the attacker full control over the application.\nTo prevent this, use a templating language that automatically escapes values to prevent XSS vulnerabilities on the server.\nDon't create Angular templates on the server side using a templating language. This carries a high risk of introducing template-injection vulnerabilities.</p>\n\n<p><a id=\"http\"></a></p>\n<!-- vale Angular.Google_Acronyms = NO -->\n<h2 id=\"http-level-vulnerabilities\" translation-result=\"on\">HTTP 级漏洞<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#http-level-vulnerabilities\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\">HTTP-level vulnerabilities<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#http-level-vulnerabilities\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">Angular 内置了一些支持来防范两个常见的 HTTP 漏洞：跨站请求伪造（XSRF）和跨站脚本包含（XSSI）。这两个漏洞主要在服务器端防范，但是 Angular 也自带了一些辅助特性，可以让客户端的集成变得更容易。</p><p translation-origin=\"off\">Angular has built-in support to help prevent two common HTTP vulnerabilities, cross-site request forgery (CSRF or XSRF) and cross-site script inclusion (XSSI).\nBoth of these must be mitigated primarily on the server side, but Angular provides helpers to make integration on the client side easier.</p>\n\n<p><a id=\"xsrf\"></a></p>\n<h3 id=\"cross-site-request-forgery\" translation-result=\"on\">跨站请求伪造<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#cross-site-request-forgery\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Cross-site request forgery<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#cross-site-request-forgery\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">在跨站请求伪造（XSRF 或 CSRF）中，攻击者欺骗用户，让他们访问一个假冒页面(比如 <code>evil.com</code>)。该页面带有恶意代码，秘密的向你的应用程序服务器发送恶意请求(比如 <code>example-bank.com</code>)。</p><p translation-origin=\"off\">In a cross-site request forgery (CSRF or XSRF), an attacker tricks the user into visiting a different web page (such as <code>evil.com</code>) with malignant code. This web page secretly sends a malicious request to the application's web server (such as <code>example-bank.com</code>).</p>\n\n<p translation-result=\"on\">假设用户已经在 <code>example-bank.com</code> 登录。用户打开一个邮件，点击里面的链接，在新页面中打开 <code>evil.com</code>。</p><p translation-origin=\"off\">Assume the user is logged into the application at <code>example-bank.com</code>.\nThe user opens an email and clicks a link to <code>evil.com</code>, which opens in a new tab.</p>\n\n<p translation-result=\"on\">该 <code>evil.com</code> 页面立刻发送恶意请求到 <code>example-bank.com</code>。这个请求可能是从用户账户转账到攻击者的账户。与该请求一起，浏览器自动发出 <code>example-bank.com</code> 的 cookie。</p><p translation-origin=\"off\">The <code>evil.com</code> page immediately sends a malicious request to <code>example-bank.com</code>.\nPerhaps it's a request to transfer money from the user's account to the attacker's account.\nThe browser automatically sends the <code>example-bank.com</code> cookies, including the authentication cookie, with this request.</p>\n\n<p translation-result=\"on\">如果 <code>example-bank.com</code> 服务器缺乏 XSRF 保护，就无法辨识请求是从应用程序发来的合法请求还是从 <code>evil.com</code> 来的假请求。</p><p translation-origin=\"off\">If the <code>example-bank.com</code> server lacks XSRF protection, it can't tell the difference between a legitimate request from the application and the forged request from <code>evil.com</code>.</p>\n\n<p translation-result=\"on\">为了防止这种情况，你必须确保每个用户的请求都是从你自己的应用中发出的，而不是从另一个网站发出的。客户端和服务器必须合作来抵挡这种攻击。</p><p translation-origin=\"off\">To prevent this, the application must ensure that a user request originates from the real application, not from a different site.\nThe server and client must cooperate to thwart this attack.</p>\n\n<p translation-result=\"on\">常见的反 XSRF 技术是服务器随机生成一个用户认证令牌到 cookie 中。客户端代码获取这个 cookie，并用它为接下来所有的请求添加自定义请求页头。服务器比较收到的 cookie 值与请求页头的值，如果它们不匹配，便拒绝请求。</p><p translation-origin=\"off\">In a common anti-XSRF technique, the application server sends a randomly created authentication token in a cookie.\nThe client code reads the cookie and adds a custom request header with the token in all following requests.\nThe server compares the received cookie value to the request header value and rejects the request if the values are missing or don't match.</p>\n\n<p translation-result=\"on\">这个技术之所以有效，是因为所有浏览器都实现了<em>同源策略</em>。只有设置 cookie 的网站的代码可以访问该站的 cookie，并为该站的请求设置自定义页头。这就是说，只有你的应用程序可以获取这个 cookie 令牌和设置自定义页头。<code>evil.com</code> 的恶意代码不能。</p><p translation-origin=\"off\">This technique is effective because all browsers implement the <em>same origin policy</em>.\nOnly code from the website on which cookies are set can read the cookies from that site and set custom headers on requests to that site.\nThat means only your application can read this cookie token and set the custom header.\nThe malicious code on <code>evil.com</code> can't.</p>\n\n<p translation-result=\"on\">Angular 的 <code><a href=\"api/common/http/HttpClient\" class=\"code-anchor\">HttpClient</a></code> 对这项技术的客户端部分提供了内置的支持要了解更多信息，参阅 <a href=\"guide/http#security-xsrf-protection\">HttpClient 部分</a>。</p><p translation-origin=\"off\">Angular's <code><a href=\"api/common/http/HttpClient\" class=\"code-anchor\">HttpClient</a></code> has built-in support for the client-side half of this technique.\nRead about it more in the <a href=\"guide/http#security-xsrf-protection\">HttpClient guide</a>.</p>\n\n<p translation-result=\"on\">可到 \"开放式 Web 应用程序安全项目 (OWASP) \" 深入了解 CSRF，参阅<a href=\"https://owasp.org/www-community/attacks/csrf\">Cross-Site Request Forgery (CSRF)</a> 和<a href=\"https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html\">Cross-Site Request Forgery (CSRF) Prevention Cheat Sheet</a>。这个斯坦福大学论文 <a href=\"https://seclab.stanford.edu/websec/csrf/csrf.pdf\">Robust Defenses for Cross-Site Request Forgery</a> 有详尽的细节。</p><p translation-origin=\"off\">For information about CSRF at the Open Web Application Security Project (OWASP), see <a href=\"https://owasp.org/www-community/attacks/csrf\">Cross-Site Request Forgery (CSRF)</a> and <a href=\"https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html\">Cross-Site Request Forgery (CSRF) Prevention Cheat Sheet</a>.\nThe Stanford University paper <a href=\"https://seclab.stanford.edu/websec/csrf/csrf.pdf\">Robust Defenses for Cross-Site Request Forgery</a> is a rich source of detail.</p>\n\n<p translation-result=\"on\">参阅 Dave Smith 在<a href=\"https://www.youtube.com/watch?v=9inczw6qtpY\" title=\"Cross Site Request Funkery Securing Your Angular Apps From Evil Doers\">AngularConnect 2016 关于 XSRF 的演讲</a>。</p><p translation-origin=\"off\">See also Dave Smith's <a href=\"https://www.youtube.com/watch?v=9inczw6qtpY\" title=\"Cross Site Request Funkery Securing Your Angular Apps From Evil Doers\">talk on XSRF at AngularConnect 2016</a>.</p>\n\n<!-- vale Angular.Google_Acronyms = YES -->\n<p><a id=\"xssi\"></a></p>\n<h3 id=\"cross-site-script-inclusion-xssi\" translation-result=\"on\">跨站脚本包含(XSSI)<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#cross-site-script-inclusion-xssi\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Cross-site script inclusion (XSSI)<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#cross-site-script-inclusion-xssi\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">跨站脚本包含，也被称为 Json 漏洞，它可以允许一个攻击者的网站从 JSON API 读取数据。这种攻击发生在老的浏览器上，它重写原生 JavaScript 对象的构造函数，然后使用 <code>&lt;script&gt;</code> 标签包含一个 API 的 URL。</p><p translation-origin=\"off\">Cross-site script inclusion, also known as JSON vulnerability, can allow an attacker's website to read data from a JSON API.\nThe attack works on older browsers by overriding built-in JavaScript object constructors, and then including an API URL using a <code>&lt;script&gt;</code> tag.</p>\n\n<p translation-result=\"on\">只有在返回的 JSON 能像 JavaScript 一样可以被执行时，这种攻击才会生效。所以服务端会约定给所有 JSON 响应体加上前缀 <code>\")]}',\\n\"</code>，来把它们标记为不可执行的，以防范这种攻击。</p><p translation-origin=\"off\">This attack is only successful if the returned JSON is executable as JavaScript.\nServers can prevent an attack by prefixing all JSON responses to make them non-executable, by convention, using the well-known string <code>\")]}',\\n\"</code>.</p>\n\n<p translation-result=\"on\">Angular 的 <code><a href=\"api/common/http/HttpClient\" class=\"code-anchor\">HttpClient</a></code> 库会识别这种约定，并在进一步解析之前，自动把字符串 <code>\")]}',\\n\"</code> 从所有响应中去掉。</p><p translation-origin=\"off\">Angular's <code><a href=\"api/common/http/HttpClient\" class=\"code-anchor\">HttpClient</a></code> library recognizes this convention and automatically strips the string <code>\")]}',\\n\"</code> from all responses before further parsing.</p>\n\n<p translation-result=\"on\">要学习更多这方面的知识，请参阅<a href=\"https://security.googleblog.com/2011/05/website-security-for-webmasters.html\">谷歌 Web 安全博客文章</a>的 XSSI 小节。</p><p translation-origin=\"off\">For more information, see the XSSI section of this <a href=\"https://security.googleblog.com/2011/05/website-security-for-webmasters.html\">Google web security blog post</a>.</p>\n\n<p><a id=\"code-review\"></a></p>\n<h2 id=\"auditing-angular-applications\" translation-result=\"on\">审计 Angular 应用程序<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#auditing-angular-applications\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\">Auditing Angular applications<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/security#auditing-angular-applications\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">Angular 应用应该遵循和常规 Web 应用一样的安全原则并按照这些原则进行审计。Angular 中某些应该在安全评审中被审计的 API（比如<a href=\"guide/security#bypass-security-apis\"><em>bypassSecurityTrust</em></a> API）都在文档中被明确标记为安全性敏感的。</p><p translation-origin=\"off\">Angular applications must follow the same security principles as regular web applications, and must be audited as such.\nAngular-specific APIs that should be audited in a security review, such as the <a href=\"guide/security#bypass-security-apis\"><em>bypassSecurityTrust</em></a> methods, are marked in the documentation as security sensitive.</p>\n\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  <div class=\"reviewed\">最后复查时间： 2/28/2022</div>\n</div>\n\n\n<!-- links to this doc:\n - guide/architecture-next-steps\n - guide/example-apps-list\n - guide/template-overview\n - guide/template-syntax\n-->\n<!-- links from this doc:\n - api/animations/style\n - api/common/NgOptimizedImage\n - api/common/http/HttpClient\n - api/core/Compiler\n - api/core/ElementRef\n - api/core/SecurityContext\n - api/platform-browser-dynamic/platformBrowserDynamic\n - api/platform-browser/DomSanitizer\n - api/platform-browser/DomSanitizer#sanitize\n - api/platform-browser/SafeValue\n - guide/dynamic-form\n - guide/http#security-xsrf-protection\n - guide/security#angular-的跨站脚本安全模型\n - guide/security#angulars-cross-site-scripting-security-model\n - guide/security#auditing-angular-applications\n - guide/security#bypass-security-apis\n - guide/security#content-security-policy\n - guide/security#cross-site-request-forgery\n - guide/security#cross-site-script-inclusion-xssi\n - guide/security#direct-use-of-the-dom-apis-and-explicit-sanitization-calls\n - guide/security#enforcing-trusted-types\n - guide/security#http-level-vulnerabilities\n - guide/security#http-级漏洞\n - guide/security#offline-template-compiler\n - guide/security#preventing-cross-site-scripting-xss\n - guide/security#sanitization-and-security-contexts\n - guide/security#sanitization-example\n - guide/security#security\n - guide/security#server-side-xss-protection\n - guide/security#trusted-types\n - guide/security#trusting-safe-values\n - guide/security#use-the-aot-template-compiler\n - guide/security#使用-aot-模板编译器\n - guide/security#信任安全值\n - guide/security#内容安全政策\n - guide/security#安全\n - guide/security#审计-angular-应用程序\n - guide/security#强制执行可信类型\n - guide/security#无害化处理与安全环境\n - guide/security#无害化范例\n - guide/security#服务器端-xss-保护\n - guide/security#跨站脚本包含xssi\n - guide/security#跨站请求伪造\n - guide/security#避免直接使用-dom-api\n - guide/security#防范跨站脚本xss攻击\n - https://bughunters.google.com/about/rules/6521337925468160/google-open-source-software-vulnerability-reward-program-rules\n - https://bughunters.google.com/report\n - https://caniuse.com/trusted-types\n - https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html\n - https://developers.google.com/web/fundamentals/security/csp\n - https://en.wikipedia.org/wiki/Code_injection\n - https://en.wikipedia.org/wiki/Cross-site_scripting\n - https://en.wikipedia.org/wiki/Web_platform\n - https://github.com/angular/angular-cn/edit/cn/aio/content/guide/security.md?message=docs%3A%20请简述你的修改...\n - https://github.com/angular/angular/blob/main/CHANGELOG.md\n - https://github.com/angular/angular/issues/6361\n - https://owasp.org/www-community/attacks/csrf\n - https://seclab.stanford.edu/websec/csrf/csrf.pdf\n - https://security.googleblog.com/2011/05/website-security-for-webmasters.html\n - https://w3c.github.io/webappsec-trusted-types/dist/spec\n - https://web.dev/trusted-types/#how-to-use-trusted-types\n - https://www.google.com/about/appsecurity\n - https://www.google.com/about/appsecurity/\n - https://www.owasp.org/index.php/Category:OWASP_Guide_Project\n - https://www.youtube.com/watch?v=9inczw6qtpY\n-->"}