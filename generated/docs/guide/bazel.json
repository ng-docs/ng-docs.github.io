{
  "id": "guide/bazel",
  "title": "Building with Bazel",
  "contents": "\n\n\n  <div class=\"github-links\">\n    <a href=\"https://github.com/angular/angular-cn/edit/aio/aio/content/guide/bazel.md?message=docs%3A%20请简述你的修改...\" aria-label=\"提供编辑建议\" title=\"提供编辑建议\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n  </div>\n\n\n<div class=\"content\">\n<h1 id=\"building-with-bazel\" translation-result=\"on\">用 Bazel 进行构建<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#building-with-bazel\"><i class=\"material-icons\">link</i></a></h1><h1 translation-origin=\"off\" id=\"building-with-bazel\">Building with Bazel<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#building-with-bazel\"><i class=\"material-icons\">link</i></a></h1>\n\n<p translation-result=\"on\">本章讲解了如何使用 Bazel 来构建和测试 Angular 应用。</p><p translation-origin=\"off\">This guide explains how to build and test Angular apps with Bazel. </p>\n\n<div class=\"alert is-helpful\">\n<p translation-result=\"on\">本指南假设你已经熟悉如何使用 <a href=\"cli\">CLI</a> 来开发和构建 Angular 应用了。</p><p translation-origin=\"off\">This guide assumes you are already familiar with developing and building Angular applications using the <a href=\"cli\">CLI</a>. </p>\n\n<p translation-result=\"on\">这里描述的这些特性是 Angular Labs 的一部分，因此不是稳定的、受支持的 API。</p><p translation-origin=\"off\">It describes features which are part of Angular Labs, and are not considered a stable, supported API.</p>\n\n</div>\n<h2 id=\"using-bazel-with-the-angular-cli\" translation-result=\"on\">在 Angular CLI 中使用 Bazel<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#using-bazel-with-the-angular-cli\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"using-bazel-with-the-angular-cli\">Using Bazel with the Angular CLI<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#using-bazel-with-the-angular-cli\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\"><code>@angular/bazel</code> 包提供了一个构建器，允许 Angular CLI 使用 Bazel 作为构建工具。</p><p translation-origin=\"off\">The <code>@angular/bazel</code> package provides a builder that allows Angular CLI to use Bazel as the build tool.</p>\n\n<p translation-result=\"on\">要有选择的为现有应用添加它，请运行</p><p translation-origin=\"off\">To opt-in an existing application, run</p>\n\n<code-example language=\"sh\">\nng add @angular/bazel\n</code-example>\n<p translation-result=\"on\">要在新的应用中使用 Bazel，首先要全局安装<code>@angular/bazel</code></p><p translation-origin=\"off\">To use Bazel in a new application, first install <code>@angular/bazel</code> globally</p>\n\n<code-example language=\"sh\">\nnpm install -g @angular/bazel\n</code-example>\n<p translation-result=\"on\">然后使用下列命令创建新的应用</p><p translation-origin=\"off\">then create the new application with</p>\n\n<code-example language=\"sh\">\nng new --collection=@angular/bazel\n</code-example>\n<p translation-result=\"on\">当你使用 Angular CLI 的构建类命令时（比如 <code>ng build</code> 和 <code>ng serve</code>），Bazel 会在幕后工作。 Bazel 的输出会显示在 <code>dist/bin</code> 文件夹中。</p><p translation-origin=\"off\">Now when you use Angular CLI build commands such as <code>ng build</code> and <code>ng serve</code>,\nBazel is used behind the scenes.\nOutputs from Bazel appear in the <code>dist/bin</code> folder.</p>\n\n<blockquote>\n<p translation-result=\"on\">命令行输出中还包括来自 Bazel 的额外日志记录。我们计划在未来减少这种情况。</p><p translation-origin=\"off\">The command-line output includes extra logging from Bazel.\nWe plan to reduce this in the future.</p>\n\n</blockquote>\n<h3 id=\"removing-bazel\" translation-result=\"on\">去掉 Bazel<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#removing-bazel\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\" id=\"removing-bazel\">Removing Bazel<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#removing-bazel\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">如果你不想使用 Bazel，你可以恢复备份文件：</p><p translation-origin=\"off\">If you need to opt-out from using Bazel, you can restore the backup files:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\">用 <code>/angular.json.bak</code> 替换 <code>/angular.json</code></p><p translation-origin=\"off\"><code>/angular.json.bak</code> replaces <code>/angular.json</code></p>\n\n</li>\n<li>\n<p translation-result=\"on\">用 <code>/tsconfig.json.bak</code> 替换 <code>/tsconfig.json</code></p><p translation-origin=\"off\"><code>/tsconfig.json.bak</code> replaces <code>/tsconfig.json</code></p>\n\n</li>\n</ul>\n<h2 id=\"advanced-configuration\" translation-result=\"on\">高级配置<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#advanced-configuration\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"advanced-configuration\">Advanced configuration<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#advanced-configuration\"><i class=\"material-icons\">link</i></a></h2>\n\n<div class=\"alert is-helpful\">\n<p translation-result=\"on\">编辑这份 Bazel 配置可以防止你有选择的退出 Bazel。 Bazel 驱动的自定义行为在其它构建器中是无用的。</p><p translation-origin=\"off\">Editing the Bazel configuration may prevent you opting out of Bazel.\nCustom behaviors driven by Bazel won't be available in other Builders.</p>\n\n<p translation-result=\"on\">本节假设你熟悉 <a href=\"https://docs.bazel.build\">Bazel</a> 。</p><p translation-origin=\"off\">This section assumes you are familiar with <a href=\"https://docs.bazel.build\">Bazel</a>.</p>\n\n</div>\n<p translation-result=\"on\">你可以手动把 Bazel 配置调整为：</p><p translation-origin=\"off\">You can manually adjust the Bazel configuration to:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\">自定义构建步骤</p><p translation-origin=\"off\">customize the build steps</p>\n\n</li>\n<li>\n<p translation-result=\"on\">构建过程并行化，以支持可延展性和增量构建</p><p translation-origin=\"off\">parallellize the build for scale and incrementality</p>\n\n</li>\n</ul>\n<p translation-result=\"on\">运行以下命令，创建初始的 Bazel 配置文件：</p><p translation-origin=\"off\">Create the initial Bazel configuration files by running the following command: </p>\n\n<code-example language=\"sh\">\nng build --leaveBazelFilesOnDisk\n</code-example>\n<p translation-result=\"on\">在 Angular 工作区中，你会找到一些新文件：</p><p translation-origin=\"off\">Now you'll find new files in the Angular workspace:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\"><code>/WORKSPACE</code> 会告诉 Bazel 要如何下载外部依赖。</p><p translation-origin=\"off\"><code>/WORKSPACE</code> tells Bazel how to download external dependencies.</p>\n\n</li>\n<li>\n<p translation-result=\"on\"><code>/BUILD.bazel</code> 和 <code>/src/BUILD.bazel</code> 会告诉 Bazel 你的源代码在哪里。</p><p translation-origin=\"off\"><code>/BUILD.bazel</code> and <code>/src/BUILD.bazel</code> tell Bazel about your source code.</p>\n\n</li>\n</ul>\n<p translation-result=\"on\">你可以在 <a href=\"http://github.com/angular/angular-bazel-example\">http://github.com/angular/angular-bazel-example</a> 找到一个全功能的 Bazel 配置示例。</p><p translation-origin=\"off\">You can find a full-featured example with custom Bazel configurations at <a href=\"http://github.com/angular/angular-bazel-example\">http://github.com/angular/angular-bazel-example</a>.</p>\n\n<p translation-result=\"on\"><a href=\"https://docs.bazel.build/versions/master/bazel-and-javascript.html\">https://docs.bazel.build/versions/master/bazel-and-javascript.html</a> 则是一个关于如何使用 Bazel 进行前端项目的文档链接。</p><p translation-origin=\"off\">Documentation for using Bazel for frontend projects is linked from <a href=\"https://docs.bazel.build/versions/master/bazel-and-javascript.html\">https://docs.bazel.build/versions/master/bazel-and-javascript.html</a>.</p>\n\n<h2 id=\"running-bazel-directly\" translation-result=\"on\">直接运行 Bazel<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#running-bazel-directly\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"running-bazel-directly\">Running Bazel directly<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#running-bazel-directly\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">在某些情况下，你会想要绕过 Angular CLI 的构建器，并直接运行Bazel CLI。 Bazel CLI 位于 <code>@bazel/bazel</code> npm 包中。你可以全局安装它，以便你能通过路径获取 <code>bazel</code> 命令，或者用 <code>$(npm bin)/bazel</code> 代替下面的 bazel。</p><p translation-origin=\"off\">In some cases you'll want to bypass the Angular CLI builder, and run the Bazel CLI directly.\nThe Bazel CLI is in the <code>@bazel/bazel</code> npm package.\nYou can install it globally to get the <code>bazel</code> command in your path, or use <code>$(npm bin)/bazel</code> in place of bazel below.</p>\n\n<p translation-result=\"on\">Bazel 的常用命令有：</p><p translation-origin=\"off\">The common commands in Bazel are:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\"><code>bazel build [targets]</code>：编译指定目标的默认输出成果。</p><p translation-origin=\"off\"><code>bazel build [targets]</code>: Compile the default output artifacts of the given targets.</p>\n\n</li>\n<li>\n<p translation-result=\"on\"><code>bazel test [targets]</code>：对于那些符合 <code>*_test</code> 模式的目标，运行测试。</p><p translation-origin=\"off\"><code>bazel test [targets]</code>: For whichever <code>*_test</code> targets are found in the patterns, run the tests.</p>\n\n</li>\n<li>\n<p translation-result=\"on\"><code>bazel run [<a href=\"api/router/RouterLinkWithHref#target\" class=\"code-anchor\">target</a>]</code>：编译目标所代表的程序，然后运行它。</p><p translation-origin=\"off\"><code>bazel run [<a href=\"api/router/RouterLinkWithHref#target\" class=\"code-anchor\">target</a>]</code>: Compile the program represented by target, and then run it.</p>\n\n</li>\n</ul>\n<p translation-result=\"on\">要想在输入发生变化时重复执行此命令（即 watch 模式），请把这些命令中的 <code>bazel</code> 替换为 <code>ibazel</code>。</p><p translation-origin=\"off\">To repeat the command any time the inputs change (watch mode), replace <code>bazel</code> with <code>ibazel</code> in these commands.</p>\n\n<p translation-result=\"on\">在输出中打印了输出到的位置。</p><p translation-origin=\"off\">The output locations are printed in the output.</p>\n\n<p translation-result=\"on\">Bazel CLI 的完整文档位于 <a href=\"https://docs.bazel.build/versions/master/command-line-reference.html\">https://docs.bazel.build/versions/master/command-line-reference.html</a> 。</p><p translation-origin=\"off\">Full documentation for the Bazel CLI is at <a href=\"https://docs.bazel.build/versions/master/command-line-reference.html\">https://docs.bazel.build/versions/master/command-line-reference.html</a>.</p>\n\n<h2 id=\"querying-the-build-graph\" translation-result=\"on\">查询构建图谱<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#querying-the-build-graph\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"querying-the-build-graph\">Querying the build graph<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#querying-the-build-graph\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">Bazel 会根据你的目标构造一个图谱，你可以从中找到很多有用的信息。</p><p translation-origin=\"off\">Because Bazel constructs a graph out of your targets, you can find lots of useful information.</p>\n\n<p translation-result=\"on\">使用一个名叫 graphviz 的可选依赖，可以得到一个名叫 <code>dot</code> 的程序，这样你就可以用它来进行 <code>bazel <a href=\"api/animations/query\" class=\"code-anchor\">query</a></code> 了：</p><p translation-origin=\"off\">Using the graphviz optional dependency, you'll have a program <code>dot</code>, which you can use with <code>bazel <a href=\"api/animations/query\" class=\"code-anchor\">query</a></code>:</p>\n\n<code-example language=\"bash\">\n$ bazel <a href=\"api/animations/query\" class=\"code-anchor\">query</a> --output=graph ... | dot -Tpng > graph.png\n</code-example>\n<p translation-result=\"on\">关于 <code>bazel <a href=\"api/animations/query\" class=\"code-anchor\">query</a></code> 的详细信息，参见 <a href=\"https://docs.bazel.build/versions/master/query-how-to.html\">https://docs.bazel.build/versions/master/query-how-to.html</a> 。</p><p translation-origin=\"off\">See <a href=\"https://docs.bazel.build/versions/master/query-how-to.html\">https://docs.bazel.build/versions/master/query-how-to.html</a> for more details on <code>bazel <a href=\"api/animations/query\" class=\"code-anchor\">query</a></code>.</p>\n\n<h2 id=\"customizing-buildbazel-files\" translation-result=\"on\">自定义 <code>BUILD.bazel</code> 文件<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#customizing-buildbazel-files\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"customizing-buildbazel-files\">Customizing <code>BUILD.bazel</code> files<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/bazel#customizing-buildbazel-files\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">“规则（Rules）”就好比 Bazel 的插件。有很多可用的规则集。本指南记录了 Angular 开发组在 Google 所做的一部分工作。</p><p translation-origin=\"off\">\"Rules\" are like plugins for Bazel. Many rule sets are available. This guide documents the ones maintained by the Angular team at Google.</p>\n\n<p translation-result=\"on\"><code>BUILD.bazel</code> 文件中用到了一些规则，这些规则都是工作空间中各个包的标记。每个 <code>BUILD.bazel</code> 文件都会向 Bazel 声明一个单独的包。你也可以使用更粗粒度的发布方式，但这样一来你发布的包（例如，到<code>npm</code> ）就会由很多个 Bazel 包组合而成。</p><p translation-origin=\"off\">Rules are used in <code>BUILD.bazel</code> files, which are markers for the packages in your workspace. Each <code>BUILD.bazel</code> file declares a separate package to Bazel, though you can have more coarse-grained distributions so that the packages you publish (for example, to <code>npm</code>) can be made up of many Bazel packages.</p>\n\n<p translation-result=\"on\">在 <code>BUILD.bazel</code> 文件中，必须首先使用 <code>load</code> 语句导入每个规则。然后用一些属性调用此规则，调用此规则的结果就是向 Bazel 中声明了：当给定一些输入和依赖的时候该如何得到一些输出。然后，当你运行一个 <code>bazel</code> 命令时，Bazel 就会加载你声明过的所有规则，以确定它们在运行期间的绝对顺序。注意，只有那些在产生输出时真正起作用的规则才会被执行。</p><p translation-origin=\"off\">In the <code>BUILD.bazel</code> file, each rule must first be imported, using the <code>load</code> statement. Then the rule is called with some attributes, and the result of calling the rule is that you've declared to Bazel how it can derive some outputs given some inputs and dependencies. Then later, when you run a <code>bazel</code> command line, Bazel loads all the rules you've declared to determine an absolute ordering of what needs to be run. Note that only the rules needed to produce the requested output will actually be executed.</p>\n\n<p translation-result=\"on\">在 <a href=\"https://github.com/bazelbuild/rules_nodejs/\">https://github.com/bazelbuild/rules_nodejs/</a> 上的 README 文件中记录了前端开发中要用到的通用规则列表。</p><p translation-origin=\"off\">A list of common rules for frontend development is documented in the README at <a href=\"https://github.com/bazelbuild/rules_nodejs/\">https://github.com/bazelbuild/rules_nodejs/</a>. </p>\n\n\n</div>\n\n<!-- links to this doc:\n - cli\n-->\n<!-- links from this doc:\n - api/animations/query\n - api/router/RouterLinkWithHref#target\n - cli\n - guide/bazel#advanced-configuration\n - guide/bazel#building-with-bazel\n - guide/bazel#customizing-buildbazel-files\n - guide/bazel#querying-the-build-graph\n - guide/bazel#removing-bazel\n - guide/bazel#running-bazel-directly\n - guide/bazel#using-bazel-with-the-angular-cli\n - http://github.com/angular/angular-bazel-example\n - https://docs.bazel.build\n - https://docs.bazel.build/versions/master/bazel-and-javascript.html\n - https://docs.bazel.build/versions/master/command-line-reference.html\n - https://docs.bazel.build/versions/master/query-how-to.html\n - https://github.com/angular/angular-cn/edit/aio/aio/content/guide/bazel.md?message=docs%3A%20请简述你的修改...\n - https://github.com/bazelbuild/rules_nodejs/\n-->"
}