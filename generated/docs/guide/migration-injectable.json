{
  "id": "guide/migration-injectable",
  "title": "Migration for missing @Injectable() decorators and incomplete provider definitions",
  "contents": "\n\n\n<div class=\"github-links\">\n  <a href=\"https://github.com/angular/angular-cn/edit/aio/aio/content/guide/migration-injectable.md?message=docs%3A%20请简述你的修改...\" aria-label=\"提供编辑建议\" title=\"提供编辑建议\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n</div>\n\n\n<div class=\"content\">\n  <h1 id=\"migration-for-missing-injectable-decorators-and-incomplete-provider-definitions\" translation-result=\"on\">迁移缺少 <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> 装饰器和不完整的服务提供者定义<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-injectable#migration-for-missing-injectable-decorators-and-incomplete-provider-definitions\"><i class=\"material-icons\">link</i></a></h1><h1 translation-origin=\"off\" id=\"migration-for-missing-injectable-decorators-and-incomplete-provider-definitions\">Migration for missing <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> decorators and incomplete provider definitions<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-injectable#migration-for-missing-injectable-decorators-and-incomplete-provider-definitions\"><i class=\"material-icons\">link</i></a></h1>\n\n<h3 id=\"what-does-this-schematic-do\" translation-result=\"on\">这个原理图做了什么？<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-injectable#what-does-this-schematic-do\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\" id=\"what-does-this-schematic-do\">What does this schematic do?<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-injectable#what-does-this-schematic-do\"><i class=\"material-icons\">link</i></a></h3>\n\n<ol>\n<li>\n<p translation-result=\"on\">该原理图会为应用中不带装饰器的服务提供者添加一个 <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> 装饰器。</p><p translation-origin=\"off\">This schematic adds an <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> decorator to classes which are provided in the application but are not decorated.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">该原理图更新了符合 <code>{provide: SomeToken}</code> 模式的提供者，以帮它显式指定 <code>useValue: undefined</code>。</p><p translation-origin=\"off\">The schematic updates providers which follow the <code>{provide: SomeToken}</code> pattern to explicitly specify <code>useValue: undefined</code>.</p>\n\n</li>\n</ol>\n<p translation-result=\"on\"><strong>缺少 <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> 的例子</strong></p><p translation-origin=\"off\"><strong>Example for missing <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code></strong></p>\n\n<p translation-result=\"on\"><strong>迁移之前</strong>：</p><p translation-origin=\"off\"><strong>Before migration</strong>:</p>\n\n<code-example format=\"typescript\" language=\"typescript\">\n\nexport class MyService {…}\nexport class MyOtherService {…}\nexport class MyThirdClass {…}\nexport class MyFourthClass {…}\nexport class MyFifthClass {…}\n\n@<a href=\"api/core/NgModule\" class=\"code-anchor\">NgModule</a>({\n  providers: [\n    MyService,\n    {provide: SOME_TOKEN, useClass: MyOtherService},\n    // The following classes do not need to be decorated because they\n    // are never instantiated and just serve as DI tokens.\n    {provide: MyThirdClass, useValue: …},\n    {provide: MyFourthClass, useFactory: …},\n    {provide: MyFifthClass, useExisting: …},\n  ]\n})\n\n</code-example>\n<p translation-result=\"on\"><strong>迁移后</strong>：</p><p translation-origin=\"off\"><strong>After migration</strong>:</p>\n\n<code-example format=\"typescript\" language=\"typescript\">\n\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class MyService {…}\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class MyOtherService {…}\nexport class MyThirdClass {…}\nexport class MyFourthClass {…}\nexport class MySixthClass {…}\n\n…\n\n</code-example>\n<div class=\"alert is-helpful\">\n<p translation-result=\"on\"><strong>注意</strong>：<br>\n<code>MyThirdClass</code>、<code>MyFourthClass</code> 和 <code>MyFifthClass</code> 不需要用 <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> 进行修饰，因为它们永远不会被实例化，而只是用作<a href=\"guide/glossary#di-token\" title=\"DI token - Glossary | Angular\">DI 令牌</a>。</p><p translation-origin=\"off\"><strong>NOTE</strong>: <br>\n<code>MyThirdClass</code>, <code>MyFourthClass</code>, and <code>MyFifthClass</code> do not need to be decorated with <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> because they are never instantiated, but just used as a <a href=\"guide/glossary#di-token\" title=\"DI token - Glossary | Angular\">DI token</a>.</p>\n\n</div>\n<p translation-result=\"on\"><strong>需要 <code>useValue: undefined</code></strong> 的提供者例子</p><p translation-origin=\"off\"><strong>Example for provider needing <code>useValue: undefined</code></strong></p>\n\n<p translation-result=\"on\">这个例子展示了一个符合 <code>{provide: X}</code> 模式的提供者。需要把提供者迁移成一个更明确的定义，其中指定了 <code>useValue: undefined</code>。</p><p translation-origin=\"off\">This example shows a provider following the <code>{provide: X}</code> pattern.\nThe provider needs to be migrated to a more explicit definition where <code>useValue: undefined</code> is specified.</p>\n\n<p translation-result=\"on\"><strong>迁移之前</strong>：</p><p translation-origin=\"off\"><strong>Before migration</strong>:</p>\n\n<code-example format=\"typescript\" language=\"typescript\">\n\n{provide: MyToken}\n\n</code-example>\n<p translation-result=\"on\"><strong>迁移完成后</strong>：</p><p translation-origin=\"off\"><strong>After migration</strong>:</p>\n\n<code-example format=\"typescript\" language=\"typescript\">\n\n{provide: MyToken, useValue: undefined}\n\n</code-example>\n<h3 id=\"why-is-adding-injectable-necessary\" translation-result=\"on\">为什么需要添加 <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> ？<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-injectable#why-is-adding-injectable-necessary\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\" id=\"why-is-adding-injectable-necessary\">Why is adding <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> necessary?<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-injectable#why-is-adding-injectable-necessary\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">在我们的文档中，始终建议把 <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> 装饰器添加到应用提供或注入的任何类中。但是，旧版本的 Angular 确实允许在没有装饰器的情况下注入一个类，比如 AOT 模式。这意味着，如果你不小心省略了装饰器，你的应用可能会继续工作，尽管某些地方缺少 <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> 装饰器。对于 Angular 的未来版本，这是有问题的。最终，我们计划严格要求装饰器，因为这样可以进一步优化编译器和运行时。这个原理图添加了任何可能缺失的 <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> 装饰器，以适应你的应用的未来发展。</p><p translation-origin=\"off\">In our docs, we've always recommended adding <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> decorators to any class that is provided or injected in your application.\nHowever, older versions of Angular did allow injection of a class without the decorator in certain cases, such as AOT mode.\nThis means if you accidentally omitted the decorator, your application may have continued to work despite missing <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> decorators in some places.\nThis is problematic for future versions of Angular.\nEventually, we plan to strictly require the decorator because doing so enables further optimization of both the compiler and the runtime.\nThis schematic adds any <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> decorators that may be missing to future-proof your app.</p>\n\n<h3 id=\"why-is-adding-usevalue-undefined-necessary\" translation-result=\"on\">为什么要添加 <code>useValue: undefined</code>，有必要吗？<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-injectable#why-is-adding-usevalue-undefined-necessary\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\" id=\"why-is-adding-usevalue-undefined-necessary\">Why is adding <code>useValue: undefined</code> necessary?<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-injectable#why-is-adding-usevalue-undefined-necessary\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">考虑以下模式：</p><p translation-origin=\"off\">Consider the following pattern:</p>\n\n<code-example format=\"typescript\" language=\"typescript\">\n\n@<a href=\"api/core/NgModule\" class=\"code-anchor\">NgModule</a>({\n  providers: [{provide: MyService}]\n})\n\n</code-example>\n<p translation-result=\"on\">那些使用这个模式的服务提供者会把其行为看作 <a href=\"guide/glossary#di-token\" title=\"DI token - Glossary | Angular\">DI 令牌</a> 为 <code>MyService</code>，其值为 <code>undefined</code>。但在 Ivy 的情况下并非如此，这些提供者会被解释为指定了 <code>useClass: MyService</code>。这意味着当升级到版本 9 或更高版本时，这些提供者的行为会有所不同。为了保证提供者的行为和以前一样，DI 的值应该显式设置为 <code>undefined</code>。</p><p translation-origin=\"off\">Providers using this pattern will behave as if they provide <code>MyService</code> as <a href=\"guide/glossary#di-token\" title=\"DI token - Glossary | Angular\">DI token</a>\nwith the value of <code>undefined</code>.\nThis is not the case in Ivy where such providers will be interpreted as if <code>useClass: MyService</code> is specified.\nThis means that these providers will behave differently when updating to version 9 and above.\nTo ensure that the provider behaves the same as before, the DI value should be explicitly set to <code>undefined</code>.</p>\n\n<h3 id=\"when-should-i-be-adding-injectable-decorators-to-classes\" translation-result=\"on\">我什么时候应该把 <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> 装饰器添加到类中？<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-injectable#when-should-i-be-adding-injectable-decorators-to-classes\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\" id=\"when-should-i-be-adding-injectable-decorators-to-classes\">When should I be adding <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> decorators to classes?<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-injectable#when-should-i-be-adding-injectable-decorators-to-classes\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">任何提供的类都必须带有 <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> 装饰器。该装饰器是框架通过 DI 要正确创建该类实例时所必需的。</p><p translation-origin=\"off\">Any class that is provided must have an <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> decorator.\nThe decorator is necessary for the framework to properly create an instance of that class through DI.</p>\n\n<p translation-result=\"on\">但是，那些已经用 <code>@<a href=\"api/core/Pipe\" class=\"code-anchor\">Pipe</a></code>，<code>@<a href=\"api/core/Component\" class=\"code-anchor\">Component</a></code>，或 <code>@<a href=\"api/core/Directive\" class=\"code-anchor\">Directive</a></code> 装饰过的类不需要这个装饰器。现有的类装饰器已经指示编译器生成了所需的信息。</p><p translation-origin=\"off\">However, classes which are already decorated with <code>@<a href=\"api/core/Pipe\" class=\"code-anchor\">Pipe</a></code>, <code>@<a href=\"api/core/Component\" class=\"code-anchor\">Component</a></code> or <code>@<a href=\"api/core/Directive\" class=\"code-anchor\">Directive</a></code> do not need both decorators.\nThe existing class decorator already instructs the compiler to generate the\nneeded information.</p>\n\n<h3 id=\"should-i-update-my-library\" translation-result=\"on\">我应该更新我的库吗？<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-injectable#should-i-update-my-library\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\" id=\"should-i-update-my-library\">Should I update my library?<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-injectable#should-i-update-my-library\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">是的，如果你的库中有任何要注入的类，那么都应该使用 <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> 装饰器对它们进行更新。在 Angular 的未来版本中，缺少某些 <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> 装饰器会抛出一个错误。</p><p translation-origin=\"off\">Yes, if your library has any classes that are meant to be injected, they should be updated with the <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> decorator.\nIn a future version of Angular, a missing <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()</code> decorator will always throw an error.</p>\n\n<p translation-result=\"on\">此外，应该更新库中符合 <code>{provide: X}</code> 模式的提供者，以显式指定一个值。如果没有明确的值，这些提供者可能会在使用你的库的应用中根据 Angular 版本而采取不同的行为。</p><p translation-origin=\"off\">Additionally, providers in your library that follow the described <code>{provide: X}</code> pattern should be updated to specify an explicit value.\nWithout explicit value, these providers can behave differently based on the Angular version in applications consuming your library.</p>\n\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  <div class=\"reviewed\">最后复查时间： 2/28/2022</div>\n</div>\n\n\n<!-- links to this doc:\n-->\n<!-- links from this doc:\n - api/core/Component\n - api/core/Directive\n - api/core/Injectable\n - api/core/NgModule\n - api/core/Pipe\n - guide/glossary#di-token\n - guide/migration-injectable#migration-for-missing-injectable-decorators-and-incomplete-provider-definitions\n - guide/migration-injectable#should-i-update-my-library\n - guide/migration-injectable#what-does-this-schematic-do\n - guide/migration-injectable#when-should-i-be-adding-injectable-decorators-to-classes\n - guide/migration-injectable#why-is-adding-injectable-necessary\n - guide/migration-injectable#why-is-adding-usevalue-undefined-necessary\n - https://github.com/angular/angular-cn/edit/aio/aio/content/guide/migration-injectable.md?message=docs%3A%20请简述你的修改...\n-->"
}