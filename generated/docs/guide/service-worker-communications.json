{"id":"guide/service-worker-communications","title":"Service worker communication","contents":"\n\n\n<div class=\"github-links\">\n  <a href=\"https://github.com/ng-docs/angular-cn/edit/cn/aio/content/guide/service-worker-communications.md?message=docs%3A%20请简述你的修改...\" aria-label=\"提供编辑建议\" title=\"提供编辑建议\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n</div>\n\n\n<div class=\"content\">\n  <h1 id=\"service-worker-communication\" translation-result=\"on\">与 Service Worker 通讯<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#service-worker-communication\"><i class=\"material-icons\">link</i></a></h1><h1 translation-origin=\"off\">Service worker communication<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#service-worker-communication\"><i class=\"material-icons\">link</i></a></h1>\n\n<p translation-result=\"on\">把 <code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> 导入到你的 <code>AppModule</code> 中不仅会注册 Service Worker，还会提供一些服务，让你能和 Service Worker 通讯，并控制你的应用缓存。</p><p translation-origin=\"off\">Importing <code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> into your <code>AppModule</code> doesn't just register the service worker, it also provides a few services you can use to interact with the service worker and control the caching of your application.</p>\n\n<h2 id=\"prerequisites\" translation-result=\"on\">前提条件<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#prerequisites\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\">Prerequisites<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#prerequisites\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">对下列知识有基本的了解：</p><p translation-origin=\"off\">A basic understanding of the following:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\"><a href=\"guide/service-worker-getting-started\">Service Worker 快速上手</a>。</p><p translation-origin=\"off\"><a href=\"guide/service-worker-getting-started\">Getting Started with Service Workers</a></p>\n\n</li>\n</ul>\n<h2 id=\"swupdate-service\" translation-result=\"on\"><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 服务<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#swupdate-服务\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\"><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> service<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#swupdate-service\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\"><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 服务让你能访问一些事件，这些事件会指出 Service Worker 何时发现并安装了可用的更新</p><p translation-origin=\"off\">The <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> service gives you access to events that indicate when the service worker discovers and installs an available update for your application.</p>\n\n<p translation-result=\"on\"><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 服务支持四个独立的操作：</p><p translation-origin=\"off\">The <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> service supports three separate operations:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\">当在服务器上<em>检测到</em>新版本、已安装并可本地使用或安装失败时获得通知</p><p translation-origin=\"off\">Get notified when an updated version is <em>detected</em> on the server, <em>installed and ready</em> to be used locally or when an <em>installation fails</em></p>\n\n</li>\n<li>\n<p translation-result=\"on\">要求 Service Worker 检查服务器上是否有更新。</p><p translation-origin=\"off\">Ask the service worker to check the server for new updates</p>\n\n</li>\n<li>\n<p translation-result=\"on\">要求 Service Worker 为当前标签页激活应用的最新版本</p><p translation-origin=\"off\">Ask the service worker to activate the latest version of the application for the current tab</p>\n\n</li>\n</ul>\n<h3 id=\"version-updates\" translation-result=\"on\">版本更新<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#version-updates\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Version updates<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#version-updates\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\"><code>versionUpdates</code> 是 <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 的一个 <code>Observable</code> 属性，并且会发出四种事件类型：</p><p translation-origin=\"off\">The <code>versionUpdates</code> is an <code>Observable</code> property of <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> and emits four event types:</p>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\"><nt-wrapper translation-result=\"on\">事件类型</nt-wrapper><nt-wrapper translation-origin=\"off\">Event types</nt-wrapper></th>\n<th align=\"left\"><nt-wrapper translation-result=\"on\">详情</nt-wrapper><nt-wrapper translation-origin=\"off\">Details</nt-wrapper></th>\n</tr>\n</thead>\n<tbody>\n\n<tr>\n<td align=\"left\"><code><a href=\"api/service-worker/VersionDetectedEvent\" class=\"code-anchor\">VersionDetectedEvent</a></code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">当 Service Worker 在服务器上检测到应用程序的新版本并即将开始下载时发出。</nt-wrapper><nt-wrapper translation-origin=\"off\">Emitted when the service worker has detected a new version of the app on the server and is about to start downloading it.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><code><a href=\"api/service-worker/NoNewVersionDetectedEvent\" class=\"code-anchor\">NoNewVersionDetectedEvent</a></code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">当 Service Worker 检查了服务器上应用程序的版本并且没有找到新版本时发出。</nt-wrapper><nt-wrapper translation-origin=\"off\">Emitted when the service worker has checked the version of the app on the server and did not find a new version.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><code><a href=\"api/service-worker/VersionReadyEvent\" class=\"code-anchor\">VersionReadyEvent</a></code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">当有新版本的应用程序可供客户端激活时发出。它可用于通知用户可用的更新或提示他们刷新页面。</nt-wrapper><nt-wrapper translation-origin=\"off\">Emitted when a new version of the app is available to be activated by clients. It may be used to notify the user of an available update or prompt them to refresh the page.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><code><a href=\"api/service-worker/VersionInstallationFailedEvent\" class=\"code-anchor\">VersionInstallationFailedEvent</a></code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">在新版本安装失败时发出。它可用于日志/监控目的。</nt-wrapper><nt-wrapper translation-origin=\"off\">Emitted when the installation of a new version failed. It may be used for logging/monitoring purposes.</nt-wrapper></td>\n</tr>\n\n</tbody>\n</table>\n<code-example header=\"log-update.service.ts\" path=\"service-worker-getting-started/src/app/log-update.service.ts\" region=\"sw-update\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class LogUpdateService {\n\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    updates.versionUpdates.subscribe(evt =&gt; {\n      switch (evt.type) {\n        case 'VERSION_DETECTED':\n          console.log(`Downloading new app version: ${evt.version.hash}`);\n          break;\n        case 'VERSION_READY':\n          console.log(`Current app version: ${evt.currentVersion.hash}`);\n          console.log(`New app version ready for use: ${evt.latestVersion.hash}`);\n          break;\n        case 'VERSION_INSTALLATION_FAILED':\n          console.log(`Failed to install app version '${evt.version.hash}': ${evt.error}`);\n          break;\n      }\n    });\n  }\n}\n\n</code-example>\n<h3 id=\"checking-for-updates\" translation-result=\"on\">检查更新<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#checking-for-updates\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Checking for updates<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#checking-for-updates\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">可以要求 Service Worker 检查是否有任何更新已经发布到了服务器上。Service Worker 会在初始化和每次导航请求（也就是用户导航到应用中的另一个地址）时检查更新。不过，如果你的站点更新非常频繁，或者需要按计划进行更新，你可能会选择手动检查更新。</p><p translation-origin=\"off\">It's possible to ask the service worker to check if any updates have been deployed to the server.\nThe service worker checks for updates during initialization and on each navigation request —that is, when the user navigates from a different address to your application.\nHowever, you might choose to manually check for updates if you have a site that changes frequently or want updates to happen on a schedule.</p>\n\n<p translation-result=\"on\">通过调用 <code>checkForUpdate()</code> 方法来实现：</p><p translation-origin=\"off\">Do this with the <code>checkForUpdate()</code> method:</p>\n\n<code-example header=\"check-for-update.service.ts\" path=\"service-worker-getting-started/src/app/check-for-update.service.ts\">\nimport { <a href=\"api/core/ApplicationRef\" class=\"code-anchor\">ApplicationRef</a>, <a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a> } from '@angular/core';\nimport { <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a> } from '@angular/service-worker';\nimport { concat, interval } from 'rxjs';\nimport { first } from 'rxjs/operators';\n\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class CheckForUpdateService {\n\n  constructor(appRef: <a href=\"api/core/ApplicationRef\" class=\"code-anchor\">ApplicationRef</a>, updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    // Allow the app to stabilize first, before starting\n    // polling for updates with `interval()`.\n    const appIsStable$ = appRef.isStable.pipe(first(isStable =&gt; isStable === true));\n    const everySixHours$ = interval(6 * 60 * 60 * 1000);\n    const everySixHoursOnceAppIsStable$ = concat(appIsStable$, everySixHours$);\n\n    everySixHoursOnceAppIsStable$.subscribe(async () =&gt; {\n      try {\n        const updateFound = await updates.checkForUpdate();\n        console.log(updateFound ? 'A new version is available.' : 'Already on the latest version.');\n      } catch (err) {\n        console.error('Failed to check for updates:', err);\n      }\n    });\n  }\n}\n\n\n</code-example>\n<p translation-result=\"on\">该方法返回一个用来表示检查更新已经成功完成的 <code>Promise&lt;boolean&gt;</code>。这种检查可能会失败，它会导致此 <code>Promise</code> 被拒绝（reject）。</p><p translation-origin=\"off\">This method returns a <code>Promise&lt;boolean&gt;</code> which indicates if an update is available for activation.\nThe check might fail, which will cause a rejection of the <code>Promise</code>.</p>\n\n<div class=\"alert is-important\">\n<p translation-result=\"on\">为了避免影响页面的首次渲染，在注册 ServiceWorker 脚本之前，<code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> 默认会在应用程序达到稳定态之前等待最多 30 秒。如果不断轮询更新（比如调用 <a href=\"https://developer.mozilla.org/docs/Web/API/WindowOrWorkerGlobalScope/setInterval\">setInterval()</a> 或 RxJS 的 <a href=\"https://rxjs.dev/api/index/function/interval\">interval()</a>）就会阻止应用程序达到稳定态，则直到 30 秒结束之前都不会往浏览器中注册 ServiceWorker 脚本。</p><p translation-origin=\"off\">In order to avoid negatively affecting the initial rendering of the page, <code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> waits for up to 30 seconds by default for the application to stabilize, before registering the ServiceWorker script.\nConstantly polling for updates, for example, with <a href=\"https://developer.mozilla.org/docs/Web/API/WindowOrWorkerGlobalScope/setInterval\">setInterval()</a> or RxJS' <a href=\"https://rxjs.dev/api/index/function/interval\">interval()</a>, prevents the application from stabilizing and the ServiceWorker script is not registered with the browser until the 30 seconds upper limit is reached.</p>\n\n<div class=\"alert is-helpful\">\n<p translation-result=\"on\"><strong>注意</strong>：<br>\n应用中所执行的各种轮询都会阻止它达到稳定态。欲知详情，参阅 <a href=\"api/core/ApplicationRef#isStable\">isStable</a> 文档。</p><p translation-origin=\"off\"><strong>NOTE</strong>: <br>\nThis is true for any kind of polling done by your application.\nCheck the <a href=\"api/core/ApplicationRef#isStable\">isStable</a> documentation for more information.</p>\n\n</div>\n<p translation-result=\"on\">可以通过在开始轮询更新之前先等应用达到稳定态来消除这种延迟，如上述例子所示。另外，你还可以为 ServiceWorker 定义不一样的 <a href=\"api/service-worker/SwRegistrationOptions#registrationStrategy\">注册策略</a>。</p><p translation-origin=\"off\">Avoid that delay by waiting for the application to stabilize first, before starting to poll for updates, as shown in the preceding example.\nAlternatively, you might want to define a different <a href=\"api/service-worker/SwRegistrationOptions#registrationStrategy\">registration strategy</a> for the ServiceWorker.</p>\n\n</div>\n<h3 id=\"updating-to-the-latest-version\" translation-result=\"on\">升级到最新版本<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#updating-to-the-latest-version\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Updating to the latest version<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#updating-to-the-latest-version\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">你可以通过在新版本就绪后立即重新加载页面来将现有选项卡更新到最新版本。为避免中断用户的进度，一般来说最好提示用户并让他们确认可以重新加载页面并更新到最新版本：</p><p translation-origin=\"off\">You can update an existing tab to the latest version by reloading the page as soon as a new version is ready.\nTo avoid disrupting the user's progress, it is generally a good idea to prompt the user and let them confirm that it is OK to reload the page and update to the latest version:</p>\n\n<code-example header=\"prompt-update.service.ts\" path=\"service-worker-getting-started/src/app/prompt-update.service.ts\" region=\"sw-version-ready\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class PromptUpdateService {\n\n  constructor(swUpdate: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    swUpdate.versionUpdates\n        .pipe(filter((evt): evt is <a href=\"api/service-worker/VersionReadyEvent\" class=\"code-anchor\">VersionReadyEvent</a> =&gt; evt.type === 'VERSION_READY'))\n        .subscribe(evt =&gt; {\n          if (promptUser(evt)) {\n            // Reload the page to update to the latest version.\n            document.location.reload();\n          }\n        });\n  }\n\n}\n\n</code-example>\n<div class=\"alert is-important\">\n<p translation-result=\"on\">调用 <a href=\"api/service-worker/SwUpdate#activateUpdate\">SwUpdate#activateUpdate()</a> 会把某个页标签更新为最新版，而不必重新加载页面，但是这可能中断应用程序。</p><p translation-origin=\"off\">Calling <a href=\"api/service-worker/SwUpdate#activateUpdate\">SwUpdate#activateUpdate()</a> updates a tab to the latest version without reloading the page, but this could break the application.</p>\n\n<p translation-result=\"on\">用不重新加载的方式更新可以创建一个<a href=\"guide/glossary#app-shell\">应用外壳</a>与其它页面资源（如<a href=\"guide/glossary#lazy-loading\">惰性加载块</a>）不匹配的版本，因为文件名在不同版本之间可能发生变化。</p><p translation-origin=\"off\">Updating without reloading can create a version mismatch between the <a href=\"guide/glossary#app-shell\">application shell</a> and other page resources, such as <a href=\"guide/glossary#lazy-loading\">lazy-loaded chunks</a>, whose filenames may change between versions.</p>\n\n<p translation-result=\"on\">如果你确信对于你的特定用例，这种情况是安全的，你可以只用 <code>activateUpdate()</code>。</p><p translation-origin=\"off\">You should only use <code>activateUpdate()</code>, if you are certain it is safe for your specific use case.</p>\n\n</div>\n<h3 id=\"handling-an-unrecoverable-state\" translation-result=\"on\">处理不可恢复的状态<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#handling-an-unrecoverable-state\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Handling an unrecoverable state<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#handling-an-unrecoverable-state\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">在某些情况下，Service Worker 用来为客户端提供服务的应用版本可能处于损坏状态，如果不重新加载整个页面，则无法恢复该状态。</p><p translation-origin=\"off\">In some cases, the version of the application used by the service worker to serve a client might be in a broken state that cannot be recovered from without a full page reload.</p>\n\n<p translation-result=\"on\">比如，设想以下情形：</p><p translation-origin=\"off\">For example, imagine the following scenario:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\">用户首次打开该应用，Service Worker 会缓存该应用的最新版本。假设应用要缓存的资源包括 <code>index.html</code>、<code>main.&lt;main-hash-1&gt;.js</code> 和 <code>lazy-chunk.&lt;lazy-hash-1&gt;.js</code>。</p><p translation-origin=\"off\">A user opens the application for the first time and the service worker caches the latest version of the application.\nAssume the application's cached assets include <code>index.html</code>, <code>main.&lt;main-hash-1&gt;.js</code> and <code>lazy-chunk.&lt;lazy-hash-1&gt;.js</code>.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">用户关闭该应用程序，并且有一段时间没有打开它。</p><p translation-origin=\"off\">The user closes the application and does not open it for a while.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">一段时间后，会将新版本的应用程序部署到服务器。新版本中包含文件 <code>index.html</code>、<code>main.&lt;main-hash-2&gt;.js</code> 和 <code>lazy-chunk.&lt;lazy-hash-2&gt;.js</code>。</p><p translation-origin=\"off\">After some time, a new version of the application is deployed to the server.\nThis newer version includes the files <code>index.html</code>, <code>main.&lt;main-hash-2&gt;.js</code> and <code>lazy-chunk.&lt;lazy-hash-2&gt;.js</code>.</p>\n\n<div class=\"alert is-helpful\">\n<p translation-result=\"on\"><strong>注意</strong>：<br>\n哈希值现在已经不同了，因为文件的内容已经改变）。服务器上不再提供旧版本。</p><p translation-origin=\"off\"><strong>NOTE</strong>: <br>\nThe hashes are different now, because the content of the files changed.</p>\n\n</div>\n<p translation-result=\"on\">旧版本在服务器上不再可用。</p><p translation-origin=\"off\">The old version is no longer available on the server.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">同时，用户的浏览器决定从其缓存中清退 <code>lazy-chunk.&lt;lazy-hash-1&gt;.js</code> 浏览器可能决定从缓存中清退特定（或所有）资源，以便回收磁盘空间。</p><p translation-origin=\"off\">In the meantime, the user's browser decides to evict <code>lazy-chunk.&lt;lazy-hash-1&gt;.js</code> from its cache.\nBrowsers might decide to evict specific (or all) resources from a cache in order to reclaim disk space.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">用户再次打开本应用。此时，Service Worker 将提供它所知的最新版本，当然，实际上对我们是旧版本（<code>index.html</code> 和 <code>main.&lt;main-hash-1&gt;.js</code>）。</p><p translation-origin=\"off\">The user opens the application again.\nThe service worker serves the latest version known to it at this point, namely the old version (<code>index.html</code> and <code>main.&lt;main-hash-1&gt;.js</code>).</p>\n\n</li>\n<li>\n<p translation-result=\"on\">在稍后的某个时刻，该应用程序请求惰性捆绑包 <code>lazy-chunk.&lt;lazy-hash-1&gt;.js</code>。</p><p translation-origin=\"off\">At some later point, the application requests the lazy bundle, <code>lazy-chunk.&lt;lazy-hash-1&gt;.js</code>.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">Service Worker 无法在缓存中找到该资产（请记住浏览器已经将其清退了）。它也无法从服务器上获取它（因为服务器现在只有较新版本的 <code>lazy-chunk.&lt;lazy-hash-2&gt;.js</code>）。</p><p translation-origin=\"off\">The service worker is unable to find the asset in the cache (remember that the browser evicted it).\nNor is it able to retrieve it from the server (because the server now only has <code>lazy-chunk.&lt;lazy-hash-2&gt;.js</code> from the newer version).</p>\n\n</li>\n</ul>\n<p translation-result=\"on\">在上述情况下，Service Worker 将无法提供通常会被缓存的资产。该特定的应用程序版本已损坏，并且无法在不重新加载页面的情况下修复客户端的状态。在这种情况下，Service Worker 会通过发送 <code><a href=\"api/service-worker/UnrecoverableStateEvent\" class=\"code-anchor\">UnrecoverableStateEvent</a></code> 事件来通知客户端。可以订阅 <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>#unrecoverable</code> 以得到通知并处理这些错误。</p><p translation-origin=\"off\">In the preceding scenario, the service worker is not able to serve an asset that would normally be cached.\nThat particular application version is broken and there is no way to fix the state of the client without reloading the page.\nIn such cases, the service worker notifies the client by sending an <code><a href=\"api/service-worker/UnrecoverableStateEvent\" class=\"code-anchor\">UnrecoverableStateEvent</a></code> event.\nSubscribe to <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>#unrecoverable</code> to be notified and handle these errors.</p>\n\n<code-example header=\"handle-unrecoverable-state.service.ts\" path=\"service-worker-getting-started/src/app/handle-unrecoverable-state.service.ts\" region=\"sw-unrecoverable-state\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class HandleUnrecoverableStateService {\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    updates.unrecoverable.subscribe(event =&gt; {\n      notifyUser(\n        'An error occurred that we cannot recover from:\\n' +\n        event.reason +\n        '\\n\\nPlease reload the page.'\n      );\n    });\n  }\n}\n\n</code-example>\n<h2 id=\"more-on-angular-service-workers\" translation-result=\"on\">关于 Angular Service Worker 的更多信息<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#more-on-angular-service-workers\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\">More on Angular service workers<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#more-on-angular-service-workers\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">你可能还对下列内容感兴趣：</p><p translation-origin=\"off\">You might also be interested in the following:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\"><a href=\"guide/service-worker-notifications\">Service Worker 通知</a></p><p translation-origin=\"off\"><a href=\"guide/service-worker-notifications\">Service Worker Notifications</a></p>\n\n</li>\n</ul>\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  <div class=\"reviewed\">最后复查时间： 2/28/2022</div>\n</div>\n\n\n<!-- links to this doc:\n - api/service-worker/NoNewVersionDetectedEvent\n - api/service-worker/SwUpdate\n - api/service-worker/UnrecoverableStateEvent\n - api/service-worker/UpdateActivatedEvent\n - api/service-worker/UpdateAvailableEvent\n - api/service-worker/VersionDetectedEvent\n - api/service-worker/VersionInstallationFailedEvent\n - api/service-worker/VersionReadyEvent\n - guide/service-worker-devops\n - guide/service-worker-getting-started\n - guide/service-worker-intro\n-->\n<!-- links from this doc:\n - api/core/ApplicationRef\n - api/core/ApplicationRef#isStable\n - api/core/Injectable\n - api/service-worker/NoNewVersionDetectedEvent\n - api/service-worker/ServiceWorkerModule\n - api/service-worker/SwRegistrationOptions#registrationStrategy\n - api/service-worker/SwUpdate\n - api/service-worker/SwUpdate#activateUpdate\n - api/service-worker/UnrecoverableStateEvent\n - api/service-worker/VersionDetectedEvent\n - api/service-worker/VersionInstallationFailedEvent\n - api/service-worker/VersionReadyEvent\n - guide/glossary#app-shell\n - guide/glossary#lazy-loading\n - guide/service-worker-communications#checking-for-updates\n - guide/service-worker-communications#handling-an-unrecoverable-state\n - guide/service-worker-communications#more-on-angular-service-workers\n - guide/service-worker-communications#prerequisites\n - guide/service-worker-communications#service-worker-communication\n - guide/service-worker-communications#swupdate-service\n - guide/service-worker-communications#swupdate-服务\n - guide/service-worker-communications#updating-to-the-latest-version\n - guide/service-worker-communications#version-updates\n - guide/service-worker-communications#与-service-worker-通讯\n - guide/service-worker-communications#关于-angular-service-worker-的更多信息\n - guide/service-worker-communications#前提条件\n - guide/service-worker-communications#升级到最新版本\n - guide/service-worker-communications#处理不可恢复的状态\n - guide/service-worker-communications#检查更新\n - guide/service-worker-communications#版本更新\n - guide/service-worker-getting-started\n - guide/service-worker-notifications\n - https://developer.mozilla.org/docs/Web/API/WindowOrWorkerGlobalScope/setInterval\n - https://github.com/ng-docs/angular-cn/edit/cn/aio/content/guide/service-worker-communications.md?message=docs%3A%20请简述你的修改...\n - https://rxjs.dev/api/index/function/interval\n-->"}