{
  "id": "guide/ivy",
  "title": "Angular Ivy",
  "contents": "\n\n\n  <div class=\"github-links\">\n    <a href=\"https://github.com/angular/angular-cn/edit/aio/aio/content/guide/ivy.md?message=docs%3A%20请简述你的修改...\" aria-label=\"提供编辑建议\" title=\"提供编辑建议\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n  </div>\n\n\n<div class=\"content\">\n<h1 id=\"angular-ivy\" translation-result=\"on\">Angular Ivy ['aɪvɪ]（常春藤）<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#angular-ivy\"><i class=\"material-icons\">link</i></a></h1><h1 translation-origin=\"off\" id=\"angular-ivy\">Angular Ivy<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#angular-ivy\"><i class=\"material-icons\">link</i></a></h1>\n\n<p translation-result=\"on\">Ivy 是 Angular <a href=\"https://blog.angular.io/a-plan-for-version-8-0-and-ivy-b3318dfc19f7\">下一代编译和渲染管道</a>的代号。\n从 Angular 的版本 9 开始，这个新的编译器和运行时指令集就代替了老的编译器和运行时（即视图引擎 View Engine）成为了默认值。</p><p translation-origin=\"off\">Ivy is the code name for Angular's <a href=\"https://blog.angular.io/a-plan-for-version-8-0-and-ivy-b3318dfc19f7\">next-generation compilation and rendering pipeline</a>.\nWith the version 9 release of Angular, the new compiler and runtime instructions are used by default instead of the older compiler and runtime, known as View Engine.</p>\n\n<div class=\"alert is-helpful\">\n<p translation-result=\"on\">要想了解此<a href=\"https://www.youtube.com/watch?v=anphffaCZrQ\">编译器</a>和<a href=\"https://www.youtube.com/watch?v=S0o-4yc2n-8\">运行时</a>的更多信息，请参见我们团队的视频。</p><p translation-origin=\"off\">Learn more about the <a href=\"https://www.youtube.com/watch?v=anphffaCZrQ\">Compiler</a> and <a href=\"https://www.youtube.com/watch?v=S0o-4yc2n-8\">Runtime</a> in these videos from our team.</p>\n\n</div>\n<a id=\"aot-and-ivy\"></a>\n<h2 id=\"aot-and-ivy\" translation-result=\"on\">AOT 和 Ivy<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#aot-and-ivy\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"aot-and-ivy\">AOT and Ivy<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#aot-and-ivy\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">使用 Ivy 的 AOT 编译速度更快，应该默认使用。在 <code>angular.json</code> 工作区配置文件中，将项目的默认构建选项设置为始终使用 AOT 编译。在 Ivy 中使用应用程序国际化（i18n）时，<a href=\"guide/i18n#merge\">翻译合并</a>还需要使用 AOT 编译。</p><p translation-origin=\"off\">AOT compilation with Ivy is faster and should be used by default.\nIn the <code>angular.json</code> workspace configuration file, set the default build options for your project to always use AOT compilation.\nWhen using application internationalization (i18n) with Ivy, <a href=\"guide/i18n#merge\">translation merging</a> also requires the use of AOT compilation.</p>\n\n<code-example language=\"json\" header=\"angular.json\">\n\n{\n  \"projects\": {\n    \"my-existing-project\": {\n      \"architect\": {\n        \"build\": {\n          \"options\": {\n            ...\n            \"aot\": true,\n          }\n        }\n      }\n    }\n  }\n}\n</code-example>\n<h2 id=\"ivy-and-libraries\" translation-result=\"on\">Ivy 和库<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#ivy-and-libraries\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"ivy-and-libraries\">Ivy and libraries<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#ivy-and-libraries\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">可以使用通过 View Engine 编译器创建的库来构建 Ivy 应用程序。此兼容性由称为 Angular 兼容性编译器（ <code>ngcc</code> ）的工具提供。CLI 命令在执行 Angular 构建时会根据需要运行 <code>ngcc</code>。</p><p translation-origin=\"off\">Ivy applications can be built with libraries that were created with the View Engine compiler.\nThis compatibility is provided by a tool known as the Angular compatibility compiler (<code>ngcc</code>).\nCLI commands run <code>ngcc</code> as needed when performing an Angular build.</p>\n\n<p translation-result=\"on\">要了解关于如何发布库的知识，参见<a href=\"guide/creating-libraries#publishing-your-library\">发布库</a>部分。</p><p translation-origin=\"off\">For more information on how to publish libraries see <a href=\"guide/creating-libraries#publishing-your-library\">Publishing your Library</a>.</p>\n\n<a id=\"maintaining-library-compatibility\"></a>\n<h3 id=\"maintaining-library-compatibility\" translation-result=\"on\">保持库的兼容性<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#maintaining-library-compatibility\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\" id=\"maintaining-library-compatibility\">Maintaining library compatibility<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#maintaining-library-compatibility\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">如果你是库作者，则应从版本 9 之后继续使用 View Engine 编译器。通过让所有库继续使用 View Engine，你将与使用 Ivy 的默认 v9 应用程序以及已选择的应用程序保持兼容性。</p><p translation-origin=\"off\">If you are a library author, you should keep using the View Engine compiler as of version 9.\nBy having all libraries continue to use View Engine, you will maintain compatibility with default v9 applications that use Ivy, as well as with applications that have opted to continue using View Engine.</p>\n\n<p translation-result=\"on\">有关如何编译或打包 Angular 库的更多信息，请参见<a href=\"guide/creating-libraries\">创建库</a>指南。当你使用 Angular CLI 或 <code>ng-packagr</code> 集成的工具时，将始终以正确的方式自动构建你的库。</p><p translation-origin=\"off\">See the <a href=\"guide/creating-libraries\">Creating Libraries</a> guide for more on how to compile or bundle your Angular library.\nWhen you use the tools integrated into the Angular CLI or <code>ng-packagr</code>, your library will always be built the right way automatically.</p>\n\n<a id=\"ivy-and-universal-app-shell\"></a>\n<h2 id=\"ivy-and-universalapp-shell\" translation-result=\"on\">Ivy 和 Universal / App shell<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#ivy-and-universalapp-shell\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"ivy-and-universalapp-shell\">Ivy and Universal/App shell<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#ivy-and-universalapp-shell\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">在版本 9 中，用于 <a href=\"guide/app-shell\">App Shell</a> 和 <a href=\"guide/universal\">Angular Universal</a> 的服务器构建器会默认启用 <code>bundleDependencies</code> 选项。如果你选择放弃打包依赖项，则需要运行独立的 Angular 兼容性编译器（<code>ngcc</code>）。这是必要的，否则 Node 将无法解析 Ivy 版本的程序包。</p><p translation-origin=\"off\">In version 9, the server builder which is used for <a href=\"guide/app-shell\">App shell</a> and <a href=\"guide/universal\">Angular Universal</a> has the <code>bundleDependencies</code> option enabled by default.\nIf you opt-out of bundling dependencies you will need to run the standalone Angular compatibility compiler (<code>ngcc</code>). This is needed because otherwise Node will be unable to resolve the Ivy version of the packages.</p>\n\n<p translation-result=\"on\">你可以在每次安装 <code>ngcc</code> 后通过添加 <code>postinstall</code> <a href=\"https://docs.npmjs.com/misc/scripts\">npm 脚本</a>来运行 <code>ngcc</code> ：</p><p translation-origin=\"off\">You can run <code>ngcc</code> after each installation of node_modules by adding a <code>postinstall</code> <a href=\"https://docs.npmjs.com/misc/scripts\">npm script</a>:</p>\n\n<code-example language=\"json\" header=\"package.json\">\n{\n  \"scripts\": {\n    \"postinstall\": \"ngcc\"\n  }\n}\n</code-example>\n<div class=\"alert is-important\">\n<ul>\n<li>\n<p translation-result=\"on\">  不要使用 <code>--create-ivy-entry-points</code> 因为这将导致 Node 无法正确解析软件包的 Ivy 版本。</p><p translation-origin=\"off\">The <code>postinstall</code> script will run on every installation of <code>node_modules</code>, including those performed by <code>ng update</code> and <code>ng add</code>.\n*Don't use <code>--create-ivy-entry-points</code> as this will cause Node not to resolve the Ivy version of the packages correctly.</p>\n\n</li>\n</ul>\n</div>\n<a id=\"opting-out-of-angular-ivy\"></a>\n<h2 id=\"opting-out-of-ivy-in-version-9\" translation-result=\"on\">选择性禁用版本 9 中的 Ivy<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#opting-out-of-ivy-in-version-9\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"opting-out-of-ivy-in-version-9\">Opting out of Ivy in version 9<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#opting-out-of-ivy-in-version-9\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">在版本 9 中，Ivy 是默认值。为了在更新过程中与当前工作流兼容，你可以选择性禁用 Ivy，继续使用以前的编译器 View Engine。</p><p translation-origin=\"off\">In version 9, Ivy is the default.\nFor compatibility with current workflows during the update process, you can choose to opt out of Ivy and continue using the previous compiler, View Engine.</p>\n\n<div class=\"alert is-helpful\">\n<p translation-result=\"on\">在禁用 Ivy 之前，请查看 <a href=\"guide/ivy-compatibility#debugging\">Ivy 兼容性指南</a>中的调试建议。</p><p translation-origin=\"off\">Before disabling Ivy, check out the debugging recommendations in the <a href=\"guide/ivy-compatibility#debugging\">Ivy Compatibility Guide</a>.</p>\n\n</div>\n<p translation-result=\"on\">要选择性禁用 Ivy，要在项目的 TypeScript 配置中更改 <code>angularCompilerOptions</code>，它通常位于工作区根目录的 <code>tsconfig.app.json</code> 中。</p><p translation-origin=\"off\">To opt out of Ivy, change the <code>angularCompilerOptions</code> in your project's TypeScript configuration, most commonly located at <code>tsconfig.app.json</code> at the root of the workspace.</p>\n\n<p translation-result=\"on\">从版本 9 开始，默认情况下 <code>enableIvy</code> 标志的值设置为 <code>true</code>。</p><p translation-origin=\"off\">The value of the <code>enableIvy</code> flag is set to <code>true</code> by default, as of version 9.</p>\n\n<p translation-result=\"on\">以下示例显示了如何将 <code>enableIvy</code> 选项设置为 <code>false</code> 以便选择性的禁用 Ivy。</p><p translation-origin=\"off\">The following example shows how to set the <code>enableIvy</code> option to <code>false</code> in order to opt out of Ivy.</p>\n\n<code-example language=\"json\" header=\"tsconfig.app.json\">\n{\n  \"extends\": \"./tsconfig.json\",\n  \"compilerOptions\": {\n    \"outDir\": \"./out-tsc/app\",\n    \"types\": []\n  },\n  \"files\": [\n    \"src/main.ts\",\n    \"src/polyfills.ts\"\n  ],\n  \"include\": [\n    \"src/**/*.d.ts\"\n  ],\n  \"angularCompilerOptions\": {\n    \"enableIvy\": false\n  }\n}\n</code-example>\n<div class=\"alert is-important\">\n<p translation-result=\"on\">如果禁用 Ivy，则可能还需要重新评估是否将 AOT 编译设置为应用程序开发的默认设置，<a href=\"guide/ivy#aot-and-ivy\">如上所述</a>。</p><p translation-origin=\"off\">If you disable Ivy, you might also want to reconsider whether to make AOT compilation the default for your application development, as described <a href=\"guide/ivy#aot-and-ivy\">above</a>.</p>\n\n<p translation-result=\"on\">要恢复编译器的默认设置，请在 <code>angular.json</code> 配置文件中设置构建选项 <code>aot: false</code>。</p><p translation-origin=\"off\">To revert the compiler default, set the build option <code>aot: false</code> in the <code>angular.json</code> configuration file.</p>\n\n</div>\n<p translation-result=\"on\">如果禁用 Ivy 并且项目使用国际化，则还可以从默认位于 <code>src/polyfills.ts</code> 的项目的腻子脚本文件中删除 <code>@angular/localize</code> 运行时组件。</p><p translation-origin=\"off\">If you disable Ivy and the project uses internationalization, you can also remove the <code>@angular/localize</code> runtime component from the project's polyfills file located be default at <code>src/polyfills.ts</code>.</p>\n\n<p translation-result=\"on\">要移除它，请删除此腻子脚本文件中的一行 <code>import '@angular/localize/init';</code>。</p><p translation-origin=\"off\">To remove, delete the <code>import '@angular/localize/init';</code> line from the polyfills file.</p>\n\n<code-example language=\"typescript\" header=\"polyfills.ts\">\n/***************************************************************************************************\n * Load `$localize` onto the <a href=\"api/core/global\" class=\"code-anchor\">global</a> scope - used if i18n tags appear in Angular templates.\n */\nimport '@angular/localize/init';\n</code-example>\n<a id=\"using-ssr-without-angular-ivy\"></a>\n<h3 id=\"using-ssr-without-ivy\" translation-result=\"on\">在没有 Ivy 的情况下使用 SSR<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#using-ssr-without-ivy\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\" id=\"using-ssr-without-ivy\">Using SSR without Ivy<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/ivy#using-ssr-without-ivy\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">如果选择性禁用 Ivy，并且你的应用程序使用 <a href=\"guide/universal\">Angular Universal</a> 在服务器上渲染 Angular 应用程序，则还必须更改服务器执行引导的方式。</p><p translation-origin=\"off\">If you opt out of Ivy and your application uses  <a href=\"guide/universal\">Angular Universal</a> to render Angular applications on the server, you must also change the way the server performs bootstrapping.</p>\n\n<p translation-result=\"on\">下面的示例展示了如何修改 <code>server.ts</code> 文件以将 <code>AppServerModuleNgFactory</code> 提供为引导模块。</p><p translation-origin=\"off\">The following example shows how you modify the <code>server.ts</code> file to provide the <code>AppServerModuleNgFactory</code> as the bootstrap module.</p>\n\n<ul>\n<li>\n<p translation-result=\"on\">从 <code>app.server.module.ngfactory</code> 虚拟文件中导入 <code>AppServerModuleNgFactory</code>。</p><p translation-origin=\"off\">Import <code>AppServerModuleNgFactory</code> from the <code>app.server.module.ngfactory</code> virtual file.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">在 <code>ngExpressEngine</code> 调用中设置 <code>bootstrap: AppServerModuleNgFactory</code>。</p><p translation-origin=\"off\">Set <code>bootstrap: AppServerModuleNgFactory</code> in the <code>ngExpressEngine</code> call.</p>\n\n</li>\n</ul>\n<code-example language=\"typescript\" header=\"server.ts\">\nimport 'zone.js/dist/zone-node';\n\nimport { ngExpressEngine } from '@nguniversal/express-engine';\nimport * as express from 'express';\nimport { join } from 'path';\n\nimport { <a href=\"api/common/APP_BASE_HREF\" class=\"code-anchor\">APP_BASE_HREF</a> } from '@angular/common';\n\nimport { AppServerModuleNgFactory } from './src/app/app.server.module.ngfactory';\n\n// The Express app is exported so that it can be used by serverless Functions.\nexport function app() {\n  const server = express();\n  const distFolder = join(process.cwd(), 'dist/ivy-test/<a href=\"api/animations/browser\" class=\"code-anchor\">browser</a>');\n\n  // Our Universal express-engine (found @ https://github.com/angular/universal/tree/master/modules/express-engine)\n  server.engine('html', ngExpressEngine({\n    bootstrap: AppServerModuleNgFactory,\n  }));\n\n  server.set('view engine', 'html');\n  server.set('views', distFolder);\n\n  // Example Express Rest API endpoints\n  // app.get('/api/**', (req, res) => { });\n  // Serve <a href=\"api/upgrade/static\" class=\"code-anchor\">static</a> files from /<a href=\"api/animations/browser\" class=\"code-anchor\">browser</a>\n  server.get('*.*', express.static(distFolder, {\n    maxAge: '1y'\n  }));\n\n  // All regular routes use the Universal engine\n  server.get('*', (req, res) => {\n    res.render('index', { req, providers: [{ provide: <a href=\"api/common/APP_BASE_HREF\" class=\"code-anchor\">APP_BASE_HREF</a>, useValue: req.baseUrl }] });\n  });\n\n  return server;\n}\n\nfunction run() {\n  const port = process.env.PORT || 4000;\n\n  // Start up the Node server\n  const server = app();\n  server.listen(port, () => {\n    console.log(`Node Express server listening on http://localhost:${port}`);\n  });\n}\n\n// Webpack will replace 'require' with '__webpack_require__'\n// '__non_webpack_require__' is a proxy to Node 'require'\n// The below code is to ensure that the server is run only when not requiring the bundle.\ndeclare const __non_webpack_require__: NodeRequire;\nconst mainModule = __non_webpack_require__.main;\nif (mainModule &#x26;&#x26; mainModule.filename === __filename) {\n  run();\n}\n\nexport * from './src/main.server';\n</code-example>\n\n</div>\n\n<!-- links to this doc:\n - guide/angular-compiler-options\n - guide/aot-compiler\n - guide/glossary\n - guide/i18n\n - guide/ivy-compatibility\n - guide/updating-to-version-9\n-->\n<!-- links from this doc:\n - api/animations/browser\n - api/common/APP_BASE_HREF\n - api/core/global\n - api/upgrade/static\n - guide/app-shell\n - guide/creating-libraries\n - guide/creating-libraries#publishing-your-library\n - guide/i18n#merge\n - guide/ivy#angular-ivy\n - guide/ivy#aot-and-ivy\n - guide/ivy#ivy-and-libraries\n - guide/ivy#ivy-and-universalapp-shell\n - guide/ivy#maintaining-library-compatibility\n - guide/ivy#opting-out-of-ivy-in-version-9\n - guide/ivy#using-ssr-without-ivy\n - guide/ivy-compatibility#debugging\n - guide/universal\n - https://blog.angular.io/a-plan-for-version-8-0-and-ivy-b3318dfc19f7\n - https://docs.npmjs.com/misc/scripts\n - https://github.com/angular/angular-cn/edit/aio/aio/content/guide/ivy.md?message=docs%3A%20请简述你的修改...\n - https://www.youtube.com/watch?v=S0o-4yc2n-8\n - https://www.youtube.com/watch?v=anphffaCZrQ\n-->"
}